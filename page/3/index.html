<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"localhost","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="李宁的博客">
<meta property="og:url" content="http://localhost:4000/page/3/index.html">
<meta property="og:site_name" content="李宁的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="李宁">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://localhost:4000/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>李宁的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李宁的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/06/23/Hive%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/23/Hive%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Hive安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-06-23T00:00:00+08:00">2020-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hive/" itemprop="url" rel="index"><span itemprop="name">Hive</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#用户添加sudo">用户添加sudo</a></li>
<li><a href="#jdk安装">JDK安装</a></li>
<li><a href="#mysql安装">MySQL安装</a></li>
<li><a href="#hadoop安装">Hadoop安装</a></li>
<li><a href="#hive安装">Hive安装</a></li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="用户添加sudo">用户添加sudo</span></h2><p>为用户添加sudo权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"lining ALL=(ALL) NOPASSWD: ALL"</span> | sudo tee /etc/sudoers.d/lining</span><br></pre></td></tr></table></figure>

<h2><span id="jdk安装">JDK安装</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u221-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">unzip jce_policy-8.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cp UnlimitedJCEPolicyJDK8&#x2F;*.jar &#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221&#x2F;jre&#x2F;lib&#x2F;security&#x2F;policy&#x2F;limited&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<h2><span id="mysql安装">MySQL安装</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">sudo yum localinstall mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager --<span class="built_in">disable</span> mysql80-community</span><br><span class="line">sudo yum-config-manager --<span class="built_in">enable</span> mysql57-community</span><br><span class="line"></span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo yum install mysql-community-server</span><br><span class="line"> </span><br><span class="line">sudo systemctl start mysqld</span><br><span class="line">sudo systemctl status mysqld</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo grep <span class="string">'temporary password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line"></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'DataFusion@2021'</span>;</span><br><span class="line"></span><br><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line">update user <span class="built_in">set</span> host = <span class="string">'%'</span> <span class="built_in">where</span> user = <span class="string">'root'</span>;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql -uroot -pDataFusion@2021 -h192.168.67.3 -P3306</span><br></pre></td></tr></table></figure>

<h2><span id="hadoop安装">Hadoop安装</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hadoop-3.1.0.tar.gz</span><br><span class="line">cd hadoop-3.1.0</span><br><span class="line">cd &#x2F;home&#x2F;lining&#x2F;hadoop-3.1.0&#x2F;etc&#x2F;hadoop</span><br><span class="line"></span><br><span class="line">#免密登录</span><br><span class="line">ssh-keygen -t rsa -P &#39;&#39; -f ~&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">cat ~&#x2F;.ssh&#x2F;id_rsa.pub &gt;&gt; ~&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">chmod 0600 ~&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hadoop-env.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi core-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;hdfs:&#x2F;&#x2F;0.0.0.0:9000&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.lining.groups&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.lining.hosts&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.groups&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;*&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hdfs-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line">cd &#x2F;home&#x2F;lining&#x2F;hadoop-3.1.0</span><br><span class="line">bin&#x2F;hdfs namenode -format</span><br><span class="line"></span><br><span class="line">sbin&#x2F;start-all.sh</span><br></pre></td></tr></table></figure>

<h2><span id="hive安装">Hive安装</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin&#x2F;conf</span><br><span class="line">mv hive-env.sh.template hive-env.sh</span><br><span class="line">vim hive-env.sh </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HADOOP_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;hadoop-3.1.0</span><br><span class="line"></span><br><span class="line">export HIVE_CONF_DIR&#x3D;&#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin&#x2F;conf</span><br><span class="line"></span><br><span class="line">export HIVE_AUX_JARS_PATH&#x3D;&#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin&#x2F;lib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin&#x2F;conf&#x2F;hive-site.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; standalone&#x3D;&quot;no&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type&#x3D;&quot;text&#x2F;xsl&quot; href&#x3D;&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;javax.jdo.option.ConnectionURL&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;jdbc:mysql:&#x2F;&#x2F;192.168.67.3:3306&#x2F;hive?createDatabaseIfNotExist&#x3D;true&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;com.mysql.jdbc.Driver&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;root&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;DataFusion@2021&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;datanucleus.readOnlyDatastore&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;false&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;datanucleus.fixedDatastore&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;false&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;datanucleus.autoCreateSchema&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;datanucleus.schema.autoCreateAll&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;datanucleus.autoCreateTables&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;datanucleus.autoCreateColumns&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;hive.metastore.local&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;!-- 显示表的列名 --&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;hive.cli.print.header&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">	&lt;!-- 显示数据库名称 --&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;hive.cli.print.current.db&lt;&#x2F;name&gt;</span><br><span class="line">		&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">	&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mv mysql-connector-java-5.1.48-bin.jar &#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin&#x2F;lib</span><br><span class="line">mv mysql-connector-java-5.1.48.jar &#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin&#x2F;lib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line">export HIVE_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;apache-hive-3.1.2-bin</span><br><span class="line">export HADOOP_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;hadoop-3.1.0</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$HADOOP_HOME&#x2F;bin:$HIVE_HOME&#x2F;bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hadoop fs -mkdir           &#x2F;tmp</span><br><span class="line">bin&#x2F;hadoop fs -mkdir   -p    &#x2F;user&#x2F;hive&#x2F;warehouse</span><br><span class="line">bin&#x2F;hadoop fs -chmod g+w   &#x2F;tmp</span><br><span class="line">bin&#x2F;hadoop fs -chmod g+w   &#x2F;user&#x2F;hive&#x2F;warehouse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">schematool -dbType mysql -initSchema</span><br><span class="line"></span><br><span class="line">hiverserver2</span><br><span class="line"></span><br><span class="line">beeline -u jdbc:hive2:&#x2F;&#x2F;192.168.67.3:10000</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/06/23/Hadoop%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/23/Hadoop%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Hadoop集群安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-06-23T00:00:00+08:00">2020-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop-Cluster-Setup/" itemprop="url" rel="index"><span itemprop="name">Hadoop Cluster Setup</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#集群规划">集群规划</a></li>
<li><a href="#添加用户">添加用户</a></li>
<li><a href="#jdk安装与操作系统设置">JDK安装与操作系统设置</a></li>
<li><a href="#虚拟机拍摄快照并完整克隆">虚拟机拍摄快照并完整克隆</a></li>
<li><a href="#关键配置">关键配置</a></li>
<li><a href="#各组件单独启动停止的命令">各组件单独启动停止的命令</a></li>
<li><a href="#hadoop集群安装">Hadoop集群安装</a></li>
<li><a href="#core-sitexml">core-site.xml</a></li>
<li><a href="#hdfs-defaultxml">hdfs-default.xml</a></li>
<li><a href="#yarn-defaultxml">yarn-default.xml</a></li>
<li><a href="#mapred-defaultxml">mapred-default.xml</a></li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="集群规划">集群规划</span></h2><table>
<thead>
<tr>
<th>IP</th>
<th>角色</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>192.168.67.4</td>
<td>NameNode SecondaryNameNode DataNode ResourceManager  NodeManager</td>
<td></td>
</tr>
<tr>
<td>192.168.67.5</td>
<td>DataNode NodeManager</td>
<td></td>
</tr>
<tr>
<td>192.168.67.6</td>
<td>DataNode NodeManager</td>
<td></td>
</tr>
</tbody></table>
<h2><span id="添加用户">添加用户</span></h2><p>为用户添加sudo权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"lining ALL=(ALL) NOPASSWD: ALL"</span> | sudo tee /etc/sudoers.d/lining</span><br></pre></td></tr></table></figure>



<h2><span id="jdk安装与操作系统设置">JDK安装与操作系统设置</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u221-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">unzip jce_policy-8.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cp UnlimitedJCEPolicyJDK8&#x2F;*.jar &#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221&#x2F;jre&#x2F;lib&#x2F;security&#x2F;policy&#x2F;limited&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221</span><br><span class="line">export HADOOP_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;hadoop-3.1.0</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$HADOOP_HOME&#x2F;bin:$HADOOP_HOME&#x2F;sbin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>





<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop firewalld.service</span><br><span class="line">sudo systemctl disable firewalld.service</span><br><span class="line">sudo systemctl status firewalld.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo setenforce 0</span><br><span class="line">getenforce</span><br><span class="line">sudo sed -i &#39;s&#x2F;^ *SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">sudo cat &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line"></span><br><span class="line">sudo swapoff -a</span><br><span class="line">sudo sed -i.bak &#39;&#x2F;swap&#x2F;s&#x2F;^&#x2F;#&#x2F;&#39; &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line">sudo cat  &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">sudo echo vm.swappiness &#x3D; 10 &gt;&gt; &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">sudo sysctl vm.swappiness&#x3D;10</span><br><span class="line"></span><br><span class="line">sudo cat &#x2F;etc&#x2F;rc.d&#x2F;rc.local</span><br><span class="line">sudo echo never &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag</span><br><span class="line">sudo echo never &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled</span><br></pre></td></tr></table></figure>







<h2><span id="虚拟机拍摄快照并完整克隆">虚拟机拍摄快照并完整克隆</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">sudo hostnamectl --static set-hostname node4.unionpay.com</span><br><span class="line">sudo hostnamectl --static set-hostname node5.unionpay.com</span><br><span class="line">sudo hostnamectl --static set-hostname node6.unionpay.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo hostname -f</span><br><span class="line">sudo cat &#x2F;etc&#x2F;hostname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;hosts</span><br><span class="line">192.168.67.4 node4.unionpay.com</span><br><span class="line">192.168.67.5 node5.unionpay.com</span><br><span class="line">192.168.67.6 node6.unionpay.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo ls &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia</span><br><span class="line">sudo rm &#x2F;etc&#x2F;localtime</span><br><span class="line">sudo ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</span><br><span class="line">sudo hwclock -w</span><br><span class="line">timedatectl status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo yum -y remove chrony</span><br><span class="line">sudo yum -y install ntp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.67.4 node4.unionpay.com</span><br><span class="line"></span><br><span class="line">sudo vi &#x2F;etc&#x2F;ntp.conf</span><br><span class="line">server  127.127.1.0 iburst</span><br><span class="line">fudge  127.127.1.0 stratum 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Other</span><br><span class="line">server 192.168.67.4 iburst</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo systemctl restart ntpd</span><br><span class="line">sudo systemctl enable ntpd</span><br><span class="line"></span><br><span class="line">ntpstat</span><br><span class="line"></span><br><span class="line">ntpq -p</span><br></pre></td></tr></table></figure>



<p>Chrony</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status chronyd</span><br><span class="line"></span><br><span class="line">chronyc tracking</span><br><span class="line">chronyc -n sources -v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo vi &#x2F;etc&#x2F;chrony.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server ntp1.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server 192.168.67.4 minpoll 4 maxpoll 10 iburst</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chronyc sourcestats</span><br><span class="line">chronyc sources -v</span><br><span class="line">chronyc -n sources -v</span><br><span class="line"></span><br><span class="line">chronyc</span><br><span class="line"></span><br><span class="line">makestep</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">192.168.67.4 node4.unionpay.com</span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">ssh-copy-id node4.unionpay.com</span><br><span class="line">ssh-copy-id node5.unionpay.com</span><br><span class="line">ssh-copy-id node6.unionpay.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.67.5 node5.unionpay.com</span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">ssh-copy-id node4.unionpay.com</span><br><span class="line">ssh-copy-id node5.unionpay.com</span><br><span class="line">ssh-copy-id node6.unionpay.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.67.6 node6.unionpay.com</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">ssh-copy-id node4.unionpay.com</span><br><span class="line">ssh-copy-id node5.unionpay.com</span><br><span class="line">ssh-copy-id node6.unionpay.com</span><br></pre></td></tr></table></figure>





<h2><span id="关键配置">关键配置</span></h2><ul>
<li><code>etc/hadoop/core-site.xml</code></li>
</ul>
<table>
<thead>
<tr>
<th><code>fs.defaultFS</code></th>
<th>NameNode URI</th>
<th><a href="hdfs://host:port/">hdfs://host:port/</a></th>
</tr>
</thead>
<tbody><tr>
<td><code>io.file.buffer.size</code></td>
<td>131072</td>
<td>Size of read/write buffer used in SequenceFiles.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><code>etc/hadoop/hdfs-site.xml</code></li>
</ul>
<table>
<thead>
<tr>
<th><code>dfs.namenode.name.dir</code></th>
<th>Path on the local filesystem where the NameNode stores the namespace and transactions logs persistently.</th>
<th>If this is a comma-delimited list of directories then the name table is replicated in all of the directories, for redundancy.</th>
</tr>
</thead>
<tbody><tr>
<td><code>dfs.blocksize</code></td>
<td>268435456</td>
<td>HDFS blocksize of 256MB for large file-systems.</td>
</tr>
<tr>
<td><code>dfs.namenode.handler.count</code></td>
<td>100</td>
<td>More NameNode server threads to handle RPCs from large number of DataNodes.</td>
</tr>
<tr>
<td><code>dfs.datanode.data.dir</code></td>
<td>Comma separated list of paths on the local filesystem of a <code>DataNode</code> where it should store its blocks.</td>
<td>If this is a comma-delimited list of directories, then data will be stored in all named directories, typically on different devices.</td>
</tr>
</tbody></table>
<ul>
<li><code>etc/hadoop/yarn-site.xml</code></li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>yarn.acl.enable</code></td>
<td><code>true</code> / <code>false</code></td>
<td>Enable ACLs? Defaults to <em>false</em>.</td>
</tr>
<tr>
<td><code>yarn.admin.acl</code></td>
<td>Admin ACL</td>
<td>ACL to set admins on the cluster. ACLs are of for <em>comma-separated-usersspacecomma-separated-groups</em>. Defaults to special value of <em>**** which means *anyone</em>. Special value of just <em>space</em> means no one has access.</td>
</tr>
<tr>
<td><code>yarn.resourcemanager.address</code></td>
<td><code>ResourceManager</code> host:port for clients to submit jobs.</td>
<td><em>host:port</em> If set, overrides the hostname set in <code>yarn.resourcemanager.hostname</code>.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>yarn.log-aggregation-enable</code></td>
<td><em>false</em></td>
<td>Configuration to enable or disable log aggregation</td>
</tr>
</tbody></table>
<h2><span id="各组件单独启动停止的命令">各组件单独启动停止的命令</span></h2><p>NameNode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;hdfs namenode -format</span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;hdfs --daemon start namenode</span><br><span class="line"></span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;hdfs --daemon stop namenode</span><br></pre></td></tr></table></figure>

<p>DataNode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;hdfs --daemon start datanode</span><br><span class="line"></span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;hdfs --daemon stop datanode</span><br></pre></td></tr></table></figure>

<p>ResourceManager</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;yarn --daemon start resourcemanager</span><br><span class="line"></span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;yarn --daemon stop resourcemanager</span><br></pre></td></tr></table></figure>

<p>NodeManager </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;yarn --daemon start nodemanager</span><br><span class="line"></span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;yarn --daemon stop nodemanager</span><br></pre></td></tr></table></figure>

<p>WebAppProxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;yarn --daemon start proxyserver</span><br><span class="line"></span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;yarn stop proxyserver</span><br></pre></td></tr></table></figure>

<p>MapReduce JobHistory Server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;mapred --daemon start historyserver</span><br><span class="line"></span><br><span class="line">$HADOOP_HOME&#x2F;bin&#x2F;mapred --daemon stop historyserver</span><br></pre></td></tr></table></figure>



<p>服务访问地址</p>
<table>
<thead>
<tr>
<th align="left">Daemon</th>
<th align="left">Web Interface</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NameNode</td>
<td align="left"><a href="http://nn_host:port/">http://nn_host:port/</a></td>
<td align="left">Default HTTP port is 9870.</td>
</tr>
<tr>
<td align="left">ResourceManager</td>
<td align="left"><a href="http://rm_host:port/">http://rm_host:port/</a></td>
<td align="left">Default HTTP port is 8088.</td>
</tr>
<tr>
<td align="left">MapReduce JobHistory Server</td>
<td align="left"><a href="http://jhs_host:port/">http://jhs_host:port/</a></td>
<td align="left">Default HTTP port is 19888.</td>
</tr>
</tbody></table>
<h2><span id="hadoop集群安装">Hadoop集群安装</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hadoop-3.1.0&#x2F;etc&#x2F;hadoop&#x2F;hadoop-env.sh</span><br><span class="line"></span><br><span class="line">JAVA_HOME&#x3D;&#x2F;home&#x2F;lining&#x2F;jdk1.8.0_221</span><br><span class="line"></span><br><span class="line">#3各节点都作为DataNode</span><br><span class="line">vi hadoop-3.1.0&#x2F;etc&#x2F;hadoop&#x2F;workers</span><br><span class="line">node4.unionpay.com</span><br><span class="line">node5.unionpay.com</span><br><span class="line">node6.unionpay.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hadoop-3.1.0&#x2F;etc&#x2F;hadoop&#x2F;core-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;hdfs:&#x2F;&#x2F;node4.unionpay.com:9000&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.tmp.dir&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;&#x2F;home&#x2F;lining&#x2F;tmp&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hadoop-3.1.0&#x2F;etc&#x2F;hadoop&#x2F;hdfs-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;2&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hadoop-3.1.0&#x2F;etc&#x2F;hadoop&#x2F;mapred-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.framework.name&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;yarn&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hadoop-3.1.0&#x2F;etc&#x2F;hadoop&#x2F;yarn-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Site specific YARN configuration properties --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanger.hostname&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;node4.unionpay.com&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.aux-services&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;mapreduce_shuffle&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scp -r hadoop-3.1.0&#x2F; lining@192.168.67.5:&#x2F;home&#x2F;lining</span><br><span class="line">scp -r hadoop-3.1.0&#x2F; lining@192.168.67.6:&#x2F;home&#x2F;lining</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">node4.unionpay.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hdfs namenode -format</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start-all.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.67.4:9870</span><br></pre></td></tr></table></figure>

























<h2><span id="core-sitexml">core-site.xml</span></h2><p><a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/core-default.xml" target="_blank" rel="noopener">https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/core-default.xml</a></p>
<p>hadoop.tmp.dir                                  /tmp/hadoop-${user.name}</p>
<p>hadoop.security.authorization        false</p>
<p>hadoop.security.authentication      simple</p>
<p>hadoop.security.group.mapping    org.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback</p>
<p>hadoop.security.group.mapping.ldap.url</p>
<p>io.file.buffer.size                                4096</p>
<p>fs.defaultFS                                         </p>
<p>fs.trash.interval</p>
<p>fs.trash.checkpoint.interval</p>
<h2><span id="hdfs-defaultxml">hdfs-default.xml</span></h2><p><a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml" target="_blank" rel="noopener">https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml</a></p>
<p>dfs.namenode.rpc-address</p>
<p>dfs.datanode.address</p>
<p>dfs.namenode.edits.dir</p>
<p>dfs.permissions.enabled</p>
<p>dfs.blocksize</p>
<h2><span id="yarn-defaultxml">yarn-default.xml</span></h2><p><a href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-common/yarn-default.xml" target="_blank" rel="noopener">https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-common/yarn-default.xml</a></p>
<p>yarn.resourcemanager.address</p>
<h2><span id="mapred-defaultxml">mapred-default.xml</span></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/04/15/Java%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/15/Java%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/" class="post-title-link" itemprop="url">Java技术体系</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-15 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-15T00:00:00+08:00">2020-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB/" itemprop="url" rel="index"><span itemprop="name">Java技术体系</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#java技术体系-参考jvm">Java技术体系 (参考JVM)</a></li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="java技术体系-参考jvm">Java技术体系 (参考JVM)</span></h4><p>Java技术体系包含Java程序设计语言、Java虚拟机（JVM）、Java类库、第三方类库、Class文件格式等。  </p>
<p>1 JDK、JRE、JVM区别</p>
<p>JDK = Java程序设计语言 + Java虚拟机（JVM）+ Java类库</p>
<p>JRE = Java类库API中Java SE API子集 + JVM</p>
<p>2 JDK与JVM的选择与安装</p>
<p>(1) Oracle JDK </p>
<p><a href="https://www.oracle.com/java/technologies/javase-downloads.html" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/javase-downloads.html</a></p>
<p>默认使用HotSpot<br>jdk-14_linux-x64_bin.tar.gz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://www.oracle.com/cn/java/</span><br><span class="line">https://www.oracle.com/cn/java/technologies/javase-downloads.html</span><br></pre></td></tr></table></figure>

<p>(2) OpenJDK </p>
<p>默认使用HotSpot,可以选择使用HotSpot和OpenJ9  </p>
<p><a href="http://jdk.java.net/archive/" target="_blank" rel="noopener">http://jdk.java.net/archive/</a></p>
<p>分为Normal和Large Heap，对内存需求小的应用使用Normal</p>
<p>OpenJDK14U-jdk_x64_linux_openj9_14_36_openj9-0.19.0.tar.gz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://adoptopenjdk.net/</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf OpenJDK14U-jdk_x64_linux_openj9_14_36_openj9-0.19.0.tar.gz -C /usr/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PWD</span>/jdk-14+36.1_openj9-0.19.0/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; /etc/yum.repos.d/adoptopenjdk.repo</span><br><span class="line">[AdoptOpenJDK]</span><br><span class="line">name=AdoptOpenJDK</span><br><span class="line">baseurl=http://adoptopenjdk.jfrog.io/adoptopenjdk/rpm/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install adoptopenjdk-8-openj9</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[lining@<span class="built_in">test</span> bin]$ java -version</span><br><span class="line">openjdk version <span class="string">"14"</span> 2020-03-17</span><br><span class="line">OpenJDK Runtime Environment AdoptOpenJDK (build 14+36)</span><br><span class="line">Eclipse OpenJ9 VM AdoptOpenJDK (build openj9-0.19.0, JRE 14 Linux amd64-64-Bit Compressed References 20200318_6 (JIT enabled, AOT enabled)</span><br><span class="line">OpenJ9   - 0133ba037</span><br><span class="line">OMR      - 1c04e0ef9</span><br><span class="line">JCL      - a73be60649 based on jdk-14+36)</span><br></pre></td></tr></table></figure>

<p>(3) adoptopenjdk</p>
<p><a href="https://adoptopenjdk.net/" target="_blank" rel="noopener">https://adoptopenjdk.net/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/04/13/Flink%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/13/Flink%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Flink基础教程（一）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-13 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-13T00:00:00+08:00">2020-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flink%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Flink基础教程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#flink基本概念">Flink基本概念</a><ul>
<li><a href="#java函数式编程基础">Java函数式编程基础</a></li>
</ul>
</li>
<li><a href="#flink安装与部署">Flink安装与部署</a></li>
<li><a href="#flink-word-count">Flink Word Count</a></li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="flink基本概念">Flink基本概念</span></h4><p>Apache Flink是一个用于分布式流和批处理数据处理的开源平台，本文基于Apache Flink 1.10版。  </p>
<h5><span id="java函数式编程基础">Java函数式编程基础</span></h5><h4><span id="flink安装与部署">Flink安装与部署</span></h4><p><strong>Standalone</strong> 模式</p>
<p>配置JAVA_HOME</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#测试</span><br><span class="line">echo $JAVA_HOME</span><br><span class="line"></span><br><span class="line">#否则</span><br><span class="line">vi &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java_1.8&#x2F;jdk1.8.0_141</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br></pre></td></tr></table></figure>



<p>检查防火墙 SELinux是否关闭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">getenforce</span><br></pre></td></tr></table></figure>



<p>新建sudo用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -s &#x2F;bin&#x2F;bash -d &#x2F;home&#x2F;upflink -m upflink</span><br><span class="line"></span><br><span class="line">passwd upflink</span><br><span class="line"></span><br><span class="line">up_flink@DataFusion2020</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;upflink ALL&#x3D;(ALL) NOPASSWD: ALL&quot; | sudo tee &#x2F;etc&#x2F;sudoers.d&#x2F;upflink</span><br></pre></td></tr></table></figure>



<p>修改SSH配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;ssh&#x2F;ssh_config</span><br><span class="line">StrictHostKeyChecking no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart ssd</span><br></pre></td></tr></table></figure>



<p>配置免密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#主节点</span><br><span class="line">&#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line">x.x.x.35   node27</span><br><span class="line">x.x.x.36   node28</span><br><span class="line">x.x.x.40   node32</span><br><span class="line">x.x.x.41   node33</span><br><span class="line">x.x.x.44   node34</span><br></pre></td></tr></table></figure>

<p>复制到其他节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#主节点</span><br><span class="line">ssh-keygen -t rsa </span><br><span class="line"></span><br><span class="line">#加到自己</span><br><span class="line">ssh-copy-id -i ~&#x2F;.ssh&#x2F;id_rsa.pub upflink@x.x.x.35</span><br></pre></td></tr></table></figure>



<p>其他节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ssh upflink@x.x.x.36</span><br><span class="line">ssh-keygen -t rsa </span><br><span class="line">ssh-copy-id -i &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;id_rsa.pub upflink@x.x.x.35</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ssh upflink@x.x.x.40</span><br><span class="line">ssh-keygen -t rsa </span><br><span class="line">ssh-copy-id -i &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;id_rsa.pub upflink@x.x.x.35</span><br><span class="line"></span><br><span class="line">ssh upflink@x.x.x.41</span><br><span class="line">ssh-keygen -t rsa </span><br><span class="line">ssh-copy-id -i &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;id_rsa.pub upflink@x.x.x.35</span><br><span class="line"></span><br><span class="line">ssh upflink@x.x.x.44</span><br><span class="line">ssh-keygen -t rsa </span><br><span class="line">ssh-copy-id -i &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;id_rsa.pub upflink@x.x.x.35</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;authorized_keys upflink@x.x.x.36:&#x2F;home&#x2F;upflink&#x2F;.ssh</span><br><span class="line">scp &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;authorized_keys upflink@x.x.x.40:&#x2F;home&#x2F;upflink&#x2F;.ssh</span><br><span class="line">scp &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;authorized_keys upflink@x.x.x.x:&#x2F;home&#x2F;upflink&#x2F;.ssh</span><br><span class="line">scp &#x2F;home&#x2F;upflink&#x2F;.ssh&#x2F;authorized_keys upflink@x.x.x.x:&#x2F;home&#x2F;upflink&#x2F;.ssh</span><br></pre></td></tr></table></figure>



<p>Flink 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">masters</span><br><span class="line"></span><br><span class="line">slaves</span><br><span class="line"></span><br><span class="line">flink-conf.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jobmanager.rpc.address: node27</span><br><span class="line"></span><br><span class="line">jobmanager.rpc.port: 6123</span><br><span class="line"></span><br><span class="line">jobmanager.heap.size: 8192m</span><br><span class="line"></span><br><span class="line">taskmanager.memory.process.size: 8192m</span><br><span class="line"></span><br><span class="line">taskmanager.numberOfTaskSlots: 4</span><br><span class="line"></span><br><span class="line">parallelism.default: 1</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scp -rq &#x2F;data&#x2F;flink-1.10.1 root@gzzx28:&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line">scp -rq &#x2F;data&#x2F;flink-1.10.1 root@gzzx32:&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scp -rq &#x2F;data&#x2F;flink-1.10.1 root@gzzx33:&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scp -rq &#x2F;data&#x2F;flink-1.10.1 root@gzzx34:&#x2F;data&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chown -R upflink:upflink flink-1.10.1</span><br></pre></td></tr></table></figure>



<p>bin/start-cluster.sh</p>
<h4><span id="flink-word-count">Flink Word Count</span></h4><p>Word Count是像Java中的Hello World一样，是最基本的入门程序，本文介绍学习Flink Word Count</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/04/01/HTTPS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/01/HTTPS/" class="post-title-link" itemprop="url">HTTPS</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-01T00:00:00+08:00">2020-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HTTPS/" itemprop="url" rel="index"><span itemprop="name">HTTPS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#https">HTTPS</a></li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="https">HTTPS</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -<span class="built_in">alias</span> tomcatssl -keypass lining -keyalg RSA -keysize 2048 -validity 365 -keystore tomcatssl.pkcs12 -storepass lining</span><br></pre></td></tr></table></figure>
<p>然后输入信息，最后输入Y</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=demo</span><br><span class="line">server.port=8080</span><br><span class="line">server.ssl.key-store=classpath:tomcatssl.pkcs12</span><br><span class="line">server.ssl.key-store-password=lining</span><br><span class="line">server.ssl.key-alias=tomcatssl</span><br><span class="line">server.ssl.key-store-type=PKCS12</span><br></pre></td></tr></table></figure>

<p>这种情况下，浏览器地址必须以https://开头，http请求将不被解析</p>
<p>如果想配置HTTP转发到HTTS，则需要配置</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/23/sqoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/sqoop/" class="post-title-link" itemprop="url">Sqoop 知识库</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-23T00:00:00+08:00">2020-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Big-Data/" itemprop="url" rel="index"><span itemprop="name">Big Data</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#1-sqoop将mysql数据批量导入hdfshive">1. sqoop将MySql数据批量导入HDFS(Hive)</a></li>
<li><a href="#2-sqoop将hdfshive数据导入mysql">2. sqoop将HDFS(Hive)数据导入mysql</a></li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="1-sqoop将mysql数据批量导入hdfshive">1. sqoop将MySql数据批量导入HDFS(Hive)</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------</span></span><br><span class="line"><span class="comment"># https://github.com/liningwonder</span></span><br><span class="line"><span class="comment"># All rights reversed</span></span><br><span class="line"><span class="comment">#---------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcheck disable=SC2046</span></span><br><span class="line">APP_HOME_PATH=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_HOME_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#参数检查</span></span><br><span class="line"><span class="keyword">if</span> [ 2 -ne <span class="string">"<span class="variable">$#</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[warn] usage : sh sqoop_import_mysql2hive.sh table start_date"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">TABLE_NAME=<span class="variable">$1</span></span><br><span class="line">START_DATE=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line">IMPORT_CONFIG=<span class="string">"import.config"</span></span><br><span class="line">RESULT_FILE=<span class="string">"import.result"</span></span><br><span class="line">LOG_DIR=<span class="string">"<span class="variable">$&#123;APP_HOME_PATH&#125;</span>/logs/import"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">test_dir</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span>  [ ! -d <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">      mkdir -p <span class="variable">$1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">sqoop_submit_job</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">  jstr=<span class="variable">$@</span></span><br><span class="line">  jsarr=<span class="variable">$&#123;jstr///\\t/ &#125;</span></span><br><span class="line">  ALL_CONFIG=(<span class="variable">$jsarr</span>)</span><br><span class="line"></span><br><span class="line">  EXEC_MODE=<span class="variable">$&#123;ALL_CONFIG[0]&#125;</span></span><br><span class="line">  JDBC_URL=<span class="variable">$&#123;ALL_CONFIG[1]&#125;</span></span><br><span class="line">  JDBC_USER_NAME=<span class="variable">$&#123;ALL_CONFIG[2]&#125;</span></span><br><span class="line">  JDBC_PASSWORD=<span class="variable">$&#123;ALL_CONFIG[3]&#125;</span></span><br><span class="line">  JDBC_TABLE_NAME=<span class="variable">$&#123;ALL_CONFIG[4]&#125;</span></span><br><span class="line">  HDFS_TARGET_DIR=<span class="variable">$&#123;ALL_CONFIG[5]&#125;</span></span><br><span class="line"></span><br><span class="line">  SQOOP_JOB_NAME=<span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span>_<span class="variable">$&#123;START_DATE&#125;</span></span><br><span class="line">  SQOOP_JOB_LOG=<span class="string">"<span class="variable">$&#123;LOG_DIR&#125;</span>/<span class="variable">$&#123;SQOOP_JOB_NAME&#125;</span>import.log"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"table"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"columns"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    JDBC_COLUMNS=<span class="variable">$&#123;ALL_CONFIG[6]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --columns <span class="variable">$&#123;JDBC_COLUMNS&#125;</span> --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"where"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    JDBC_WHERE=<span class="variable">$&#123;ALL_CONFIG[6]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --<span class="built_in">where</span> <span class="variable">$&#123;JDBC_WHERE&#125;</span> --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"colwhere"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    JDBC_COLUMNS=<span class="variable">$&#123;ALL_CONFIG[6]&#125;</span></span><br><span class="line">    JDBC_WHERE=<span class="variable">$&#123;ALL_CONFIG[7]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --columns <span class="variable">$&#123;JDBC_COLUMNS&#125;</span> --<span class="built_in">where</span> <span class="variable">$&#123;JDBC_WHERE&#125;</span>  --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"append"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    JDBC_CHECK_COLUMN=<span class="variable">$&#123;ALL_CONFIG[6]&#125;</span></span><br><span class="line">    JDBC_CHECK_COLUMN_LAST=<span class="variable">$&#123;ALL_CONFIG[7]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --incremental append --check-column <span class="variable">$&#123;JDBC_CHECK_COLUMN&#125;</span> --last-value <span class="string">"<span class="variable">$&#123;JDBC_CHECK_COLUMN_LAST&#125;</span>"</span> --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"colappend"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    JDBC_COLUMNS=<span class="variable">$&#123;ALL_CONFIG[6]&#125;</span></span><br><span class="line">    JDBC_CHECK_COLUMN=<span class="variable">$&#123;ALL_CONFIG[7]&#125;</span></span><br><span class="line">    JDBC_CHECK_COLUMN_LAST=<span class="variable">$&#123;ALL_CONFIG[8]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --columns <span class="variable">$&#123;JDBC_COLUMNS&#125;</span> --incremental append --check-column <span class="variable">$&#123;JDBC_CHECK_COLUMN&#125;</span> --last-value <span class="string">"<span class="variable">$&#123;JDBC_CHECK_COLUMN_LAST&#125;</span>"</span> --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"colappendwhere"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    JDBC_COLUMNS=<span class="variable">$&#123;ALL_CONFIG[6]&#125;</span></span><br><span class="line">    JDBC_WHERE=<span class="variable">$&#123;ALL_CONFIG[7]&#125;</span></span><br><span class="line">    JDBC_CHECK_COLUMN=<span class="variable">$&#123;ALL_CONFIG[8]&#125;</span></span><br><span class="line">    JDBC_CHECK_COLUMN_LAST=<span class="variable">$&#123;ALL_CONFIG[9]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --columns <span class="variable">$&#123;JDBC_COLUMNS&#125;</span> --<span class="built_in">where</span> <span class="variable">$&#123;JDBC_WHERE&#125;</span> --incremental append --check-column <span class="variable">$&#123;JDBC_CHECK_COLUMN&#125;</span> --last-value <span class="string">"<span class="variable">$&#123;JDBC_CHECK_COLUMN_LAST&#125;</span>"</span> --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    JDBC_QUERY=<span class="variable">$&#123;ALL_CONFIG[5]&#125;</span></span><br><span class="line">    sqoop import --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --query <span class="string">"<span class="variable">$&#123;JDBC_QUERY&#125;</span> and \$CONDITIONS;"</span> -m 1 --target-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ $? -eq 0 ] ;<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;SQOOP_JOB_NAME&#125;</span> OK"</span> &gt;&gt; <span class="variable">$&#123;RESULT_FILE&#125;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;SQOOP_JOB_NAME&#125;</span> NO"</span> &gt;&gt; <span class="variable">$&#123;RESULT_FILE&#125;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test_dir <span class="variable">$LOG_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  str=<span class="variable">$line</span></span><br><span class="line">  sarr=<span class="variable">$&#123;str///\\t/ &#125;</span></span><br><span class="line">  arr=(<span class="variable">$sarr</span>)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;TABLE_NAME&#125;</span> == <span class="variable">$&#123;arr[4]&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    sqoop_submit_job <span class="variable">$&#123;line&#125;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$&#123;IMPORT_CONFIG&#125;</span></span><br></pre></td></tr></table></figure>

<p>import.config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">table   jdbc:mysql://xxx:3306/d root    xxxx    tables   /user/etltest</span><br><span class="line">colwhere        jdbc:mysql://xxx:3306/d xxx    xxxx    tables   /user/etlha     HOST_ID,NAME    HOST_ID=1</span><br><span class="line">colappendwhere  jdbc:mysql://xxx:3306/d    xxx    xxxx    tables   /user/complex/  seq_id,prod_id,rec_crt_tm,map_id        map_id=50       rec_crt_tm      2019-03-01 00:00:01</span><br></pre></td></tr></table></figure>


<h4><span id="2-sqoop将hdfshive数据导入mysql">2. sqoop将HDFS(Hive)数据导入mysql</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------</span></span><br><span class="line"><span class="comment"># Licensed to the China UnionPay License (UPL)</span></span><br><span class="line"><span class="comment"># lining@unionpaysmart.com</span></span><br><span class="line"><span class="comment"># All rights reversed</span></span><br><span class="line"><span class="comment">#---------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcheck disable=SC2046</span></span><br><span class="line">APP_HOME_PATH=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_HOME_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#参数检查</span></span><br><span class="line"><span class="keyword">if</span> [ 2 -ne <span class="string">"<span class="variable">$#</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[warn] usage : sh sqoop_import_mysql2hive.sh table start_date"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">TABLE_NAME=<span class="variable">$1</span></span><br><span class="line">START_DATE=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line">EXPORT_CONFIG=<span class="string">"export.config"</span></span><br><span class="line">RESULT_FILE=<span class="string">"export.result"</span></span><br><span class="line">LOG_DIR=<span class="string">"<span class="variable">$&#123;APP_HOME_PATH&#125;</span>/logs/export"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">test_dir</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span>  [ ! -d <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">      mkdir -p <span class="variable">$1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">sqoop_export_job</span></span>() &#123;</span><br><span class="line">    jstr=<span class="variable">$@</span></span><br><span class="line">    jsarr=<span class="variable">$&#123;jstr///\\t/ &#125;</span></span><br><span class="line">    ALL_CONFIG=(<span class="variable">$jsarr</span>)</span><br><span class="line">    EXEC_MODE=<span class="variable">$&#123;ALL_CONFIG[0]&#125;</span></span><br><span class="line">    JDBC_URL=<span class="variable">$&#123;ALL_CONFIG[1]&#125;</span></span><br><span class="line">    JDBC_USER_NAME=<span class="variable">$&#123;ALL_CONFIG[2]&#125;</span></span><br><span class="line">    JDBC_PASSWORD=<span class="variable">$&#123;ALL_CONFIG[3]&#125;</span></span><br><span class="line">    JDBC_TABLE_NAME=<span class="variable">$&#123;ALL_CONFIG[4]&#125;</span></span><br><span class="line">    HDFS_TARGET_DIR=<span class="variable">$&#123;ALL_CONFIG[5]&#125;</span></span><br><span class="line"></span><br><span class="line">    SQOOP_JOB_NAME=<span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span>_<span class="variable">$&#123;EXEC_MODE&#125;</span>_<span class="variable">$&#123;START_DATE&#125;</span></span><br><span class="line">    SQOOP_JOB_LOG=<span class="string">"<span class="variable">$&#123;LOG_DIR&#125;</span>/<span class="variable">$&#123;SQOOP_JOB_NAME&#125;</span>.log"</span></span><br><span class="line">    today=`date +%Y%m%d`</span><br><span class="line"></span><br><span class="line">    <span class="comment">#update mode can be allowinsert  updateonly</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"all"</span> == <span class="variable">$&#123;EXEC_MODE&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">      sqoop <span class="built_in">export</span> --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --<span class="built_in">export</span>-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      JDBC_UPDATE_KEY=<span class="variable">$&#123;ALL_CONFIG[7]&#125;</span></span><br><span class="line">      UPDATE_MODE=<span class="variable">$&#123;ALL_CONFIG[8]&#125;</span></span><br><span class="line">      sqoop <span class="built_in">export</span> --connect <span class="variable">$&#123;JDBC_URL&#125;</span> --username <span class="variable">$&#123;JDBC_USER_NAME&#125;</span> --password <span class="variable">$&#123;JDBC_PASSWORD&#125;</span> --table <span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> --update-key <span class="variable">$&#123;JDBC_UPDATE_KEY&#125;</span> --update-mode <span class="variable">$&#123;UPDATE_MODE&#125;</span> --<span class="built_in">export</span>-dir <span class="variable">$&#123;HDFS_TARGET_DIR&#125;</span> --fields-terminated-by <span class="string">'\t'</span> --verbose &gt;&gt; <span class="variable">$&#123;SQOOP_JOB_LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ] ; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> export <span class="variable">$&#123;today&#125;</span> OK"</span> &gt;&gt; <span class="variable">$&#123;RESULT_FILE&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;JDBC_TABLE_NAME&#125;</span> export <span class="variable">$&#123;today&#125;</span> NO"</span> &gt;&gt; <span class="variable">$&#123;RESULT_FILE&#125;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test_dir <span class="variable">$LOG_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  str=<span class="variable">$line</span></span><br><span class="line">  sarr=<span class="variable">$&#123;str///\\t/ &#125;</span></span><br><span class="line">  arr=(<span class="variable">$sarr</span>)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;TABLE_NAME&#125;</span> == <span class="variable">$&#123;arr[4]&#125;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    sqoop_export_job <span class="variable">$&#123;line&#125;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$&#123;EXPORT_CONFIG&#125;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/23/devops/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/devops/" class="post-title-link" itemprop="url">DevOps开发工具安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-23T00:00:00+08:00">2020-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#1-docker安装">1. Docker安装</a></li>
<li><a href="#2-gitlab安装">2. GitLab安装</a></li>
<li><a href="#3-sonatype-nexus3安装">3. Sonatype Nexus3安装</a><ul>
<li><a href="#31-nexus3配置">3.1 Nexus3配置</a></li>
</ul>
</li>
<li><a href="#4-linux-maven安装">4. linux maven安装</a></li>
<li><a href="#5-linux-git安装">5. linux git安装</a></li>
<li><a href="#6-genkins安装">6. genkins安装</a></li>
<li><a href="#云原生ci平台drone">云原生CI平台Drone</a></li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="1-docker安装">1. Docker安装</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum -y install docker-ce docker-ce-cli containerd.io</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>:[<span class="string">"http://hub-mirror.c.163.com"</span>],</span><br><span class="line">  <span class="string">"storage-driver"</span>:<span class="string">"devicemapper"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<p>脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">cat&gt;/etc/docker/daemon.json&lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://registry.docker-cn.com"</span>],</span><br><span class="line">  <span class="string">"storage-driver"</span>:<span class="string">"devicemapper"</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>


<h4><span id="2-gitlab安装">2. GitLab安装</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --detach \</span><br><span class="line">  --publish 80929:8929 --publish 2289:22 \</span><br><span class="line">  --name gitlab \</span><br><span class="line">  --restart always \</span><br><span class="line">  --volume /srv/gitlab/config:/etc/gitlab \</span><br><span class="line">  --volume /srv/gitlab/logs:/var/<span class="built_in">log</span>/gitlab \</span><br><span class="line">  --volume /srv/gitlab/data:/var/opt/gitlab \</span><br><span class="line">  gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure>

<p>使用简写版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker run -d -p 8929:8929 -p 2289:22 -v /srv/gitlab/config:/etc/gitlab -v /srv/gitlab/logs:/var/<span class="built_in">log</span>/gitlab -v /srv/gitlab/data:/var/opt/gitlab --name gitlab --restart always gitlab/gitlab-ce:latest</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it gitlab /bin/bash</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/gitlab/gitlab.rb</span><br><span class="line">external_url <span class="string">'http://192.168.67.28:8029'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_shell_ssh_port'</span>] = 2289</span><br><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y net-tools</span><br><span class="line">firewall-cmd  --zone=public  --add-port=8029/tcp --permanent</span><br><span class="line">firewall-cmd  --zone=public  --add-port=2289/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http://192.168.67.28:8929/</span><br><span class="line"></span><br><span class="line">配置新密码</span><br><span class="line">root/app_!QAZxsw2</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop gitlab</span><br><span class="line">docker rm gitlab</span><br><span class="line">docker rmi gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure>



<p>其他方式（非docker）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;packages.gitlab.com&#x2F;install&#x2F;repositories&#x2F;gitlab&#x2F;gitlab-ee&#x2F;script.rpm.sh | bash</span><br><span class="line">yum -y install gitlab-ee</span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl start</span><br><span class="line">gitlab-ctl status</span><br></pre></td></tr></table></figure>









<h4><span id="3-sonatype-nexus3安装">3. Sonatype Nexus3安装</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/nexus-data</span><br><span class="line"></span><br><span class="line">chmod 777 /opt/nexus-data</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker search nexus3</span><br><span class="line"></span><br><span class="line">docker pull sonatype/nexus3</span><br><span class="line"></span><br><span class="line">docker run -d -p 8081:8081 -v /opt/nexus-data:/nexus-data --name nexus --restart=always sonatype/nexus3</span><br></pre></td></tr></table></figure>

<p>离线安装镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker save -o nexus3.tar sonatype/nexus3</span><br><span class="line">scp nexus3.tar 192.168.67.28:/home/lining</span><br><span class="line">docker load &lt; nexus3.tar</span><br></pre></td></tr></table></figure>


<h5><span id="31-nexus3配置">3.1 Nexus3配置</span></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd  --zone=public  --add-port=8081/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">http://192.168.67.28:8081/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">默认的账号admin</span><br><span class="line"></span><br><span class="line">密码位于/nexus-data/admin.password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">强制修改密码</span><br><span class="line">app_!QAZxsw2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">允许匿名访问</span><br></pre></td></tr></table></figure>


<p>配置中央仓库的代理路径</p>
<p>阿里云maven代理官网 <a href="https://maven.aliyun.com/mvn/view" target="_blank" rel="noopener">https://maven.aliyun.com/mvn/view</a></p>
<p>中央仓库地址：<a href="https://maven.aliyun.com/repository/central" target="_blank" rel="noopener">https://maven.aliyun.com/repository/central</a><br><img src="/images/aliyun-central.png" width="74%" height="75%"></p>
<p>新建自定义仓库</p>
<p>Repositories -&gt; Create repositoriy -&gt; maven2(hosted)</p>
<p>Name : private-release</p>
<p>Allow redeploy</p>
<p>添加角色：<br>Nexus默认只有两种角色<br>nx-anonymous<br>nx-admin<br>创建角色 developer</p>
<img src="/images/nexus-role.png" width="74%" height="75%">


<p>创建用户</p>
<p>test/test</p>
<img src="/images/nexus-user.png" width="74%" height="75%">


<h4><span id="4-linux-maven安装">4. linux maven安装</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip apache-maven-3.6.3-bin.zip</span><br><span class="line">或tar xzvf apache-maven-3.6.3-bin.tar.gz -C /opt/maven</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile</span><br><span class="line"></span><br><span class="line">MAVEN_HOME=/opt/apache-maven-3.6.3/maven</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$MAVEN_HOME</span>/bin</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>


<p>setting.xml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;localRepository&gt;/opt/maven/repo&lt;/localRepository&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;servers&gt;</span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;id&gt;private-release&lt;/id&gt;</span><br><span class="line">    &lt;username&gt;<span class="built_in">test</span>&lt;/username&gt;</span><br><span class="line">    &lt;password&gt;<span class="built_in">test</span>&lt;/password&gt;</span><br><span class="line">  &lt;/server&gt;</span><br><span class="line">&lt;/servers&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line"></span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;development&lt;/id&gt;</span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">      &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;private-release&lt;/id&gt;</span><br><span class="line">        &lt;url&gt;http://192.168.67.28:8081/repository/private-release/&lt;/url&gt;</span><br><span class="line">      &lt;/repository&gt;</span><br><span class="line">    &lt;/repositories&gt;</span><br><span class="line">  &lt;/profile&gt;</span><br><span class="line">&lt;/profiles&gt;</span><br><span class="line">&lt;activeProfiles&gt;</span><br><span class="line">  &lt;activeProfile&gt;development&lt;/activeProfile&gt;</span><br><span class="line">&lt;/activeProfiles&gt;</span><br></pre></td></tr></table></figure>

<p>maven项目设置 pom.xml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;private-release&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;http://192.168.67.28:8081/repository/private-release/&lt;/url&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">&lt;/distributionManagement&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean deploy</span><br></pre></td></tr></table></figure>


<p>第三方jar包上传</p>
<p>可能会报权限错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy:deploy-file -DgroupId=com.unionpay.magpie -DartifactId=magpie -Dversion=2.0.5.Final -Dpackaging=jar -Dfile=magpie-2.0.5.Final.jar -Durl=http://192.168.67.28:8081/repository/private-release/</span><br></pre></td></tr></table></figure>

<p>或者通过界面上传</p>
<h4><span id="5-linux-git安装">5. linux git安装</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum -y install git</span><br><span class="line"></span><br><span class="line">git config --global user.email <span class="string">"liningwonder@163.com"</span></span><br><span class="line">git config --global user.name <span class="string">"root"</span></span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br><span class="line">复制公钥在gitlab上添加</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin ssh://git@192.168.67.28:2289/cloud/demo.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Initial commit"</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h4><span id="6-genkins安装">6. genkins安装</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/jenkins_home</span><br><span class="line">docker search blueocean</span><br><span class="line">docker pull jenkinsci/blueocean</span><br><span class="line">docker run -d -p 8080:8080 -p 50000:50000 -v /opt/jenkins_home:/var/jenkins_home --name myjenkins --restart=always jenkinsci/blueocean</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">firewall-cmd  --zone=public  --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">http://192.168.67.28:8080/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">初始密码 /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">安装初始默认插件</span><br><span class="line"></span><br><span class="line">创建第一个管理员用户或则使用admin继续</span><br><span class="line"></span><br><span class="line">lining/app_!QAZxsw2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">管理插件-高级</span><br><span class="line"></span><br><span class="line">http://updates.jenkins-ci.org/update-center.json 换成</span><br><span class="line"></span><br><span class="line">http://mirror.esuni.jp/jenkins/updates/update-center.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">手动安装 maven等其他插件</span><br><span class="line"></span><br><span class="line">Deploy to container</span><br><span class="line">Maven Integration</span><br><span class="line">Publish Over SSH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改密码</span><br><span class="line">admin/app_!QAZxsw2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">实例配置</span><br><span class="line">默认</span><br><span class="line"></span><br><span class="line">重启jenkins</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">指定JDK 容器里面的目录/usr/lib/jvm/java-1.8-openjdk</span><br><span class="line"></span><br><span class="line">这里最好预先挂载一个maven卷给他就不用下载</span><br><span class="line">指定Maven 系统安装</span><br><span class="line">指定Maven配置 docker cp settings.xml aec9caf4fe9a:/opt</span><br><span class="line">指定git</span><br></pre></td></tr></table></figure>


<p>新建maven项目</p>
<img src="/images/jenkins-new.png" width="74%" height="75%">
<img src="/images/jenkins-des.png" width="74%" height="75%">
<img src="/images/jenkins-source.png" width="74%" height="75%">
<img src="/images/jenkins-trigger.png" width="74%" height="75%">
<img src="/images/jenkins-build.png" width="74%" height="75%">
<img src="/images/jenkins-end.png" width="74%" height="75%">



<h4><span id="云原生ci平台drone">云原生CI平台Drone</span></h4><p><a href="https://www.drone.io/" target="_blank" rel="noopener">https://www.drone.io/</a></p>
<p><a href="https://docs.drone.io/server/overview/" target="_blank" rel="noopener">https://docs.drone.io/server/overview/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/23/mapreduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/mapreduce/" class="post-title-link" itemprop="url">MapReduce任务提交脚本</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-23T00:00:00+08:00">2020-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Big-Data/" itemprop="url" rel="index"><span itemprop="name">Big Data</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#1-mapreduce任务提交脚本">1. MapReduce任务提交脚本</a></li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="1-mapreduce任务提交脚本">1. MapReduce任务提交脚本</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------</span></span><br><span class="line"><span class="comment"># https://github.com/liningwonder</span></span><br><span class="line"><span class="comment"># All rights reversed</span></span><br><span class="line"><span class="comment">#---------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  <span class="function"><span class="title">hdfs_path_test</span></span>() &#123;</span><br><span class="line">    hadoop fs -<span class="built_in">test</span> -d <span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ] ;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"[warn] target hdfs data path <span class="variable">$1</span> exist"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        hadoop fs -mkdir -p <span class="variable">$1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  <span class="function"><span class="title">hdfs_path_delete</span></span>() &#123;</span><br><span class="line">    hadoop fs -<span class="built_in">test</span> -d <span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ] ;<span class="keyword">then</span></span><br><span class="line">        hadoop fs -rm -r <span class="variable">$1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcheck disable=SC2046</span></span><br><span class="line">APP_HOME_PATH=$(<span class="built_in">cd</span> `dirname <span class="variable">$0</span>`; <span class="built_in">pwd</span>)</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_HOME_PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#参数检查</span></span><br><span class="line"><span class="keyword">if</span> [ 4 -ne <span class="string">"<span class="variable">$#</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"[warn] usage : sh start_job.sh confPath url user pwd"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CONF_PATH=<span class="variable">$1</span></span><br><span class="line">JDBC_URL=<span class="variable">$2</span></span><br><span class="line">USER_NAME=<span class="variable">$3</span></span><br><span class="line">PASSWORD=<span class="variable">$4</span></span><br><span class="line"></span><br><span class="line">APP_JAR_NAME=<span class="string">"datafusion-mapreduce-1.0.0-jar-with-dependencies.jar"</span></span><br><span class="line"></span><br><span class="line">today=`date +%Y%m%d`</span><br><span class="line"></span><br><span class="line">TABLE_NAME_PREFIX=<span class="string">"tbl_apbiz_usr_trans_inf"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=9; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ALL_TABLE[i]=<span class="string">"<span class="variable">$&#123;TABLE_NAME_PREFIX&#125;</span>0<span class="variable">$&#123;i&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=10; i&lt;=31; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ALL_TABLE[i]=<span class="string">"<span class="variable">$&#123;TABLE_NAME_PREFIX&#125;</span><span class="variable">$&#123;i&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATA_PATH=<span class="string">"/tmp/transinfo"</span></span><br><span class="line">hdfs_path_test <span class="variable">$&#123;DATA_PATH&#125;</span></span><br><span class="line"></span><br><span class="line">TODAY_DATE=`date +%Y%m%d`</span><br><span class="line"></span><br><span class="line">OUTPUT_PREFIX=<span class="string">"<span class="variable">$&#123;DATA_PATH&#125;</span>/<span class="variable">$&#123;TODAY_DATE&#125;</span>/all_job_output"</span></span><br><span class="line"></span><br><span class="line">hdfs_path_test <span class="variable">$&#123;OUTPUT_PREFIX&#125;</span></span><br><span class="line"></span><br><span class="line">BK_COMBINE_INPUT_PATH=<span class="string">""</span></span><br><span class="line">OP_COMBINE_INPUT_PATH=<span class="string">""</span></span><br><span class="line">ID_COMBINE_INPUT_PATH=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=31; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;ALL_TABLE[i]&#125;</span></span><br><span class="line">  BK_JOB_OUTPUT_PATH_I=<span class="string">"<span class="variable">$&#123;OUTPUT_PREFIX&#125;</span>/job_<span class="variable">$&#123;i&#125;</span>_output/bnkcard"</span></span><br><span class="line">  hdfs_path_delete <span class="variable">$&#123;BK_JOB_OUTPUT_PATH_I&#125;</span></span><br><span class="line">  hadoop jar <span class="variable">$&#123;APP_HOME_PATH&#125;</span>/<span class="variable">$&#123;APP_JAR_NAME&#125;</span> com.unionpay.data.mr.driver.BankCardDriver <span class="variable">$&#123;CONF_PATH&#125;</span> <span class="variable">$&#123;JDBC_URL&#125;</span> <span class="variable">$&#123;USER_NAME&#125;</span> <span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;ALL_TABLE[i]&#125;</span> <span class="variable">$&#123;BK_JOB_OUTPUT_PATH_I&#125;</span> &gt;&gt; job.log 2&gt;&amp;1</span><br><span class="line">  BK_COMBINE_INPUT_PATH=<span class="string">"<span class="variable">$&#123;BK_COMBINE_INPUT_PATH&#125;</span>,<span class="variable">$&#123;BK_JOB_OUTPUT_PATH_I&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=31; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;ALL_TABLE[i]&#125;</span></span><br><span class="line">  OP_JOB_OUTPUT_PATH_I=<span class="string">"<span class="variable">$&#123;OUTPUT_PREFIX&#125;</span>/job_<span class="variable">$&#123;i&#125;</span>_output/operator"</span></span><br><span class="line">  hdfs_path_delete <span class="variable">$&#123;OP_JOB_OUTPUT_PATH_I&#125;</span></span><br><span class="line">  hadoop jar <span class="variable">$&#123;APP_HOME_PATH&#125;</span>/<span class="variable">$&#123;APP_JAR_NAME&#125;</span> com.unionpay.data.mr.driver.OperatorDriver <span class="variable">$&#123;CONF_PATH&#125;</span> <span class="variable">$&#123;JDBC_URL&#125;</span> <span class="variable">$&#123;USER_NAME&#125;</span> <span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;ALL_TABLE[i]&#125;</span> <span class="variable">$&#123;OP_JOB_OUTPUT_PATH_I&#125;</span> &gt;&gt; job.log 2&gt;&amp;1</span><br><span class="line">  OP_COMBINE_INPUT_PATH=<span class="string">"<span class="variable">$&#123;OP_COMBINE_INPUT_PATH&#125;</span>,<span class="variable">$&#123;OP_JOB_OUTPUT_PATH_I&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=31; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;ALL_TABLE[i]&#125;</span></span><br><span class="line">  ID_JOB_OUTPUT_PATH_I=<span class="string">"<span class="variable">$&#123;OUTPUT_PREFIX&#125;</span>/job_<span class="variable">$&#123;i&#125;</span>_output/idcard"</span></span><br><span class="line">  hdfs_path_delete <span class="variable">$&#123;ID_JOB_OUTPUT_PATH_I&#125;</span></span><br><span class="line">  hadoop jar <span class="variable">$&#123;APP_HOME_PATH&#125;</span>/<span class="variable">$&#123;APP_JAR_NAME&#125;</span> com.unionpay.data.mr.driver.IDCardDriver <span class="variable">$&#123;CONF_PATH&#125;</span> <span class="variable">$&#123;JDBC_URL&#125;</span> <span class="variable">$&#123;USER_NAME&#125;</span> <span class="variable">$&#123;PASSWORD&#125;</span> <span class="variable">$&#123;ALL_TABLE[i]&#125;</span> <span class="variable">$&#123;ID_JOB_OUTPUT_PATH_I&#125;</span> &gt;&gt; job.log 2&gt;&amp;1</span><br><span class="line">  ID_COMBINE_INPUT_PATH=<span class="string">"<span class="variable">$&#123;ID_COMBINE_INPUT_PATH&#125;</span>,<span class="variable">$&#123;ID_JOB_OUTPUT_PATH_I&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">BK_COMBINE_INPUT_PATH=<span class="variable">$&#123;BK_COMBINE_INPUT_PATH#*,&#125;</span></span><br><span class="line">OP_COMBINE_INPUT_PATH=<span class="variable">$&#123;OP_COMBINE_INPUT_PATH#*,&#125;</span></span><br><span class="line">ID_COMBINE_INPUT_PATH=<span class="variable">$&#123;ID_COMBINE_INPUT_PATH#*,&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;BK_COMBINE_INPUT_PATH&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;OP_COMBINE_INPUT_PATH&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;ID_COMBINE_INPUT_PATH&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">BK_COMBINE_OUTPUT_PATH=<span class="string">"<span class="variable">$&#123;DATA_PATH&#125;</span>/<span class="variable">$&#123;TODAY_DATE&#125;</span>/combine_job_output/bnkcard"</span></span><br><span class="line">OP_COMBINE_OUTPUT_PATH=<span class="string">"<span class="variable">$&#123;DATA_PATH&#125;</span>/<span class="variable">$&#123;TODAY_DATE&#125;</span>/combine_job_output/operator"</span></span><br><span class="line">ID_COMBINE_OUTPUT_PATH=<span class="string">"<span class="variable">$&#123;DATA_PATH&#125;</span>/<span class="variable">$&#123;TODAY_DATE&#125;</span>/combine_job_output/idcard"</span></span><br><span class="line"></span><br><span class="line">hdfs_path_delete <span class="variable">$&#123;BK_COMBINE_OUTPUT_PATH&#125;</span></span><br><span class="line">hdfs_path_delete <span class="variable">$&#123;OP_COMBINE_OUTPUT_PATH&#125;</span></span><br><span class="line">hdfs_path_delete <span class="variable">$&#123;ID_COMBINE_OUTPUT_PATH&#125;</span></span><br><span class="line"></span><br><span class="line">hadoop jar <span class="variable">$&#123;APP_HOME_PATH&#125;</span>/<span class="variable">$&#123;APP_JAR_NAME&#125;</span> com.xxx.CombineBankCardDriver <span class="variable">$&#123;CONF_PATH&#125;</span> <span class="variable">$&#123;BK_COMBINE_INPUT_PATH&#125;</span> <span class="variable">$&#123;BK_COMBINE_OUTPUT_PATH&#125;</span> &gt;&gt; job.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">hadoop jar <span class="variable">$&#123;APP_HOME_PATH&#125;</span>/<span class="variable">$&#123;APP_JAR_NAME&#125;</span> com.xxx.CombineOperatorDriver <span class="variable">$&#123;CONF_PATH&#125;</span> <span class="variable">$&#123;OP_COMBINE_INPUT_PATH&#125;</span> <span class="variable">$&#123;OP_COMBINE_OUTPUT_PATH&#125;</span> &gt;&gt; job.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">hadoop jar <span class="variable">$&#123;APP_HOME_PATH&#125;</span>/<span class="variable">$&#123;APP_JAR_NAME&#125;</span> com.xxx.CombineIDCardDriver <span class="variable">$&#123;CONF_PATH&#125;</span> <span class="variable">$&#123;ID_COMBINE_INPUT_PATH&#125;</span> <span class="variable">$&#123;ID_COMBINE_OUTPUT_PATH&#125;</span> &gt;&gt; job.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/18/cdh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/18/cdh/" class="post-title-link" itemprop="url">Cloudera CDH 大数据平台安装手册</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-18T00:00:00+08:00">2020-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index"><span itemprop="name">CDH</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#cloudera-cdh-大数据平台安装手册">Cloudera CDH 大数据平台安装手册</a><ul>
<li><a href="#1-硬件资源及集群规划">1. 硬件资源及集群规划</a></li>
<li><a href="#2-操作系统及软件版本">2. 操作系统及软件版本</a></li>
<li><a href="#3-基础环境设置">3. 基础环境设置</a></li>
<li><a href="#4-安装与配置">4. 安装与配置</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="cloudera-cdh-大数据平台安装手册">Cloudera CDH 大数据平台安装手册</span></h2><h4><span id="1-硬件资源及集群规划">1. 硬件资源及集群规划</span></h4><p>硬件资源  </p>
<img src="/images/cdh-hard-require.png" width="74%" height="75%">


<p>其他参考值  </p>
<table>
<thead>
<tr>
<th>角色</th>
<th>内存和处理器要求</th>
</tr>
</thead>
<tbody><tr>
<td>Hadoop JournalNode</td>
<td>1 GB (default) 1 core minimum</td>
</tr>
<tr>
<td>Hadoop NameNode</td>
<td>1 GB (for proof-of-concept deployments) Minimum of 4 dedicated cores</td>
</tr>
<tr>
<td>Hadoop DataNode</td>
<td>Minimum: 4 GB Minimum: 4 cores</td>
</tr>
<tr>
<td>HBase Master</td>
<td>100-10,000 regions: 4 GB;  10,000 or more regions with 200 or more Region Servers: 8 GB Minimum 4</td>
</tr>
<tr>
<td>HBase Region Server</td>
<td>Minimum: 8 GB</td>
</tr>
<tr>
<td>Thrift Server</td>
<td>1 GB - 4 GB</td>
</tr>
<tr>
<td>HiveServer 2</td>
<td>Single Connection    4 GB； 2-10 connections    4-6 GB; 11-20 connections    6-12 GB; 21-40; connections    12-16 GB</td>
</tr>
<tr>
<td>Hive Metastore</td>
<td>Single Connection    4 GB; 2-10 connections    4-10 GB; 11-20 connections    10-12 GB; 21-40 connections    12-16 GB</td>
</tr>
<tr>
<td>Hive-on-Spark</td>
<td>Minimum: 16 GB Recommended: 32 GB for larger data sizes Recommended: 8 cores for larger data sizes</td>
</tr>
<tr>
<td>Spark History Server</td>
<td>Minimum: 512 MB</td>
</tr>
<tr>
<td>Job History Server</td>
<td>Minimum: 1 GB Minimum: 1 core</td>
</tr>
<tr>
<td>NodeManager</td>
<td>Minimum: 1 GB Minimum: 8-16 cores</td>
</tr>
<tr>
<td>ResourceManager</td>
<td>Minimum: 1 GB Minimum: 1 core</td>
</tr>
<tr>
<td>ZooKeeper Server</td>
<td>Minimum: 1 GB Minimum: 4 cores</td>
</tr>
</tbody></table>
<p>集群规划示例  </p>
<table>
<thead>
<tr>
<th>节点</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>bigdata21</td>
<td>CM HBase REST HMS HS2 JHS HS HttpFs</td>
</tr>
<tr>
<td>bigdata22</td>
<td>HM RS DN NN NM RM ZK</td>
</tr>
<tr>
<td>bigdata23</td>
<td>RS DN SNN NM ZK HDFS Balancer</td>
</tr>
<tr>
<td>bigdata24</td>
<td>RS DN NM ZK Spark Gateway</td>
</tr>
<tr>
<td>bigdata25</td>
<td>RS DN NM WebHCat Hive GateWay</td>
</tr>
<tr>
<td>bigdata26</td>
<td>RS DN NM S2S NFS Gateway</td>
</tr>
</tbody></table>
<h4><span id="2-操作系统及软件版本">2. 操作系统及软件版本</span></h4><table>
<thead>
<tr>
<th>软件</th>
<th>版本</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>OS</td>
<td>CentOS 7.X</td>
<td></td>
</tr>
<tr>
<td>CM</td>
<td>5.16.2</td>
<td></td>
</tr>
<tr>
<td>CDH</td>
<td>5.16.2</td>
<td></td>
</tr>
<tr>
<td>JDK</td>
<td>8u181</td>
<td>需要替换java.security授权文件</td>
</tr>
<tr>
<td>MySQL</td>
<td>5.7.27</td>
<td></td>
</tr>
</tbody></table>
<h4><span id="3-基础环境设置">3. 基础环境设置</span></h4><p>(1) hostname及hosts配置（每个节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hostnamectl <span class="built_in">set</span>-hostname “bigdata21”</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x.x.x.21 bigdata21</span><br><span class="line">x.x.x.22 bigdata22</span><br><span class="line">x.x.x.23 bigdata23</span><br><span class="line">x.x.x.24 bigdata24</span><br><span class="line">x.x.x.25 bigdata25</span><br><span class="line">x.x.x.26 bigdata26</span><br></pre></td></tr></table></figure>

<p>(2) 禁用SELinux（每个节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line">vi /etc/selinux/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>

<p>(3) 关闭防火墙（每个节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>

<p>(4) 卸载chrony（每个节点执行）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove chrony</span><br></pre></td></tr></table></figure>


<p>(5) 安装ntp并配置同步（每个节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ntp</span><br><span class="line">vi /etc/ntp.conf</span><br></pre></td></tr></table></figure>

<p>x.x.x.21 作为NTP服务器，配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server  127.127.1.0 </span><br><span class="line">fudge  127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure>


<p>其他节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server x.x.x.21</span><br></pre></td></tr></table></figure>

<p>重启  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart ntpd</span><br><span class="line">systemctl <span class="built_in">enable</span> ntpd</span><br></pre></td></tr></table></figure>

<p>确认同步  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpq -p</span><br></pre></td></tr></table></figure>

<p>(6) 设置swap（每个节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> vm.swappiness = 10 &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl vm.swappiness=10</span><br></pre></td></tr></table></figure>

<p>(7) 设置透明大页面（每个节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">vi /etc/rc.d/rc.local</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled; <span class="keyword">then</span> </span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag; <span class="keyword">then</span> </span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>(8) 安装http服务（CM节点执行）  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install httpd</span><br><span class="line">systemctl start httpd</span><br><span class="line">systemctl stop httpd</span><br></pre></td></tr></table></figure>

<p>(9) 安装MySQL并初始化</p>
<p>mysql安装请参考前面的博客。各节点上传MySQL JDBC驱动到/usr/share/java/</p>
<p>(10) 制作yum源  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/var/www/html/cm5.16.2</span><br><span class="line">/var/www/html/cdh5.16.2</span><br><span class="line"></span><br><span class="line">请事先下载CM5.16.2和CM5.16.2的安装包</span><br><span class="line">使用 createrepo . 生成rpm元数据</span><br><span class="line">测试HTTP是否能够访问</span><br><span class="line"></span><br><span class="line">vi /etc/yum.repos.d/cm.repo</span><br><span class="line"></span><br><span class="line">[cmrepo]</span><br><span class="line">name = cm_repo</span><br><span class="line">baseurl = http://x.x.x.21/cm5.16.2</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line">gpgcheck = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4><span id="4-安装与配置">4. 安装与配置</span></h4><p>(1) 安装配置启动CM  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install cloudera-manager-server</span><br><span class="line"></span><br><span class="line">usr/share/cmf/schema/scm_prepare_database.sh mysql cm cm </span><br><span class="line"></span><br><span class="line">systemctl start cloudera-scm-server</span><br></pre></td></tr></table></figure>

<p>（2）根据CM引导界面添加配置集群  </p>
<p>界面地址：<a href="http://222.85.230.62:7180" target="_blank" rel="noopener">http://222.85.230.62:7180</a></p>
<p>默认用户密码：admin/admin</p>
<p>许可条款<br><img src="/images/cdh-permission.png" width="100%" height="100%"><br>部署版本<br><img src="/images/cdh-install-version.png" width="100%" height="100%"><br>安装预览<br><img src="/images/cdh-preview.png" width="100%" height="100%"><br>指定主机节点<br><img src="/images/cdh-node.png" width="100%" height="100%"><br>配置自定义yum源地址<br><img src="/images/cdh-yum-repo.png" width="100%" height="100%"><br>安装parcel<br><img src="/images/cdh-parcel.png" width="100%" height="100%"><br>检查主机<br><img src="/images/cdh-check.png" width="100%" height="100%"><br>选择安装的服务<br><img src="/images/cdh-choose1.png" width="100%" height="100%"><br>角色分配<br><img src="/images/cdh-js.png" width="100%" height="100%"><br>配置hive和am的数据库信息<br><img src="/images/cdh-mysql.png" width="100%" height="100%"><br>安装服务<br><img src="/images/cdh-install.png" width="100%" height="100%"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/Hadoop%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/Hadoop%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Hadoop源码编译</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#hadoop安装">Hadoop安装</a><ul>
<li><a href="#single-node-cluster">Single Node Cluster</a></li>
</ul>
</li>
<li><a href="#pseudo-distributed-operation-伪分布式模式">Pseudo-Distributed Operation 伪分布式模式</a><ul>
<li><a href="#yarn-on-a-single-node">YARN on a Single Node</a></li>
</ul>
<ul>
<li><a href="#hadoop-cluster-setup">Hadoop Cluster Setup</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="hadoop安装">Hadoop安装</span></h2><p>准备虚拟机环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#设置IP地址</span></span><br><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts</span><br><span class="line">vi ifcfg-ens33</span><br><span class="line"></span><br><span class="line">TYPE=<span class="string">"Ethernet"</span></span><br><span class="line">PROXY_METHOD=<span class="string">"none"</span></span><br><span class="line">BROWSER_ONLY=<span class="string">"no"</span></span><br><span class="line">BOOTPROTO=<span class="string">"static"</span></span><br><span class="line">DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6INIT=<span class="string">"yes"</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">"yes"</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">"stable-privacy"</span></span><br><span class="line">NAME=<span class="string">"ens33"</span></span><br><span class="line">UUID=<span class="string">"1b6cb313-debd-43ee-be56-e925bbb5b1b2"</span></span><br><span class="line">DEVICE=<span class="string">"ens33"</span></span><br><span class="line">ONBOOT=<span class="string">"yes"</span></span><br><span class="line">IPADDR=<span class="string">"192.168.67.21"</span></span><br><span class="line">PREFIX=<span class="string">"24"</span></span><br><span class="line">GATEWAY=<span class="string">"192.168.67.2"</span></span><br><span class="line">IPV6_PRIVACY=<span class="string">"no"</span></span><br><span class="line">DNS1=<span class="string">"114.114.114.114"</span></span><br><span class="line"></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line">systemctl status network</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置域名</span></span><br><span class="line">hostnamectl --static <span class="built_in">set</span>-hostname hadoop</span><br><span class="line">hostname -f</span><br><span class="line"></span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.67.21 hadoop</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭SELinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y wget</span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line">yum clan all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>

<p>软件安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#JDK </span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -zxvf jdk-8u221-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#JCE</span></span><br><span class="line">unzip jce_policy-8.zip</span><br><span class="line">cp /opt/UnlimitedJCEPolicyJDK8/local_policy.jar /opt/jdk1.8.0_221/jre/lib/security</span><br><span class="line">cp /opt/UnlimitedJCEPolicyJDK8/US_export_policy.jar /opt/jdk1.8.0_221/jre/lib/security</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">unzip -oj -d /opt/jdk1.8.0_221/jre/lib/security/ /opt/jce_policy-8.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.5以上的JDK不用设置CLASS_PATH</span></span><br><span class="line"><span class="comment">#如果要设置，则export CLASS_PATH=.:$JAVA_HOME/lib/:$CLASS_PATH</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/jdk1.8.0_221</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#本机免密</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.67.21</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">测试</span><br><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>

<h1><span id="single-node-cluster">Single Node Cluster</span></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt</span><br><span class="line"></span><br><span class="line">tar -zxvf hadoop-3.2.2.tar.gz</span><br><span class="line"></span><br><span class="line">cd hadoop-3.2.2</span><br><span class="line"></span><br><span class="line">&#x2F;opt&#x2F;hadoop-3.2.2&#x2F;etc&#x2F;hadoop</span><br><span class="line"></span><br><span class="line">vi hadoop-env.sh</span><br><span class="line"></span><br><span class="line">JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk1.8.0_221</span><br><span class="line"></span><br><span class="line">测试命令</span><br><span class="line">&#x2F;opt&#x2F;hadoop-3.2.2&#x2F;bin&#x2F;hadoop</span><br><span class="line"></span><br><span class="line">#By default, Hadoop is configured to run in a non-distributed mode, as a single Java process. This is useful for debugging.</span><br></pre></td></tr></table></figure>





<h2><span id="pseudo-distributed-operation-伪分布式模式">Pseudo-Distributed Operation 伪分布式模式</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;opt&#x2F;hadoop-3.2.2&#x2F;etc&#x2F;hadoop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi core-site.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;hdfs:&#x2F;&#x2F;192.168.67.21:9000&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi hdfs-site.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Format the filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bin&#x2F;hdfs namenode -format</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Start NameNode daemon and DataNode daemon</span><br><span class="line"></span><br><span class="line">sbin&#x2F;start-dfs.sh</span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line">Starting namenodes on [hadoop]</span><br><span class="line">ERROR: Attempting to operate on hdfs namenode as root</span><br><span class="line">ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting operation.</span><br><span class="line">Starting datanodes</span><br><span class="line">ERROR: Attempting to operate on hdfs datanode as root</span><br><span class="line">ERROR: but there is no HDFS_DATANODE_USER defined. Aborting operation.</span><br><span class="line">Starting secondary namenodes [hadoop]</span><br><span class="line">ERROR: Attempting to operate on hdfs secondarynamenode as root</span><br><span class="line">ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting operation.</span><br><span class="line"></span><br><span class="line">vi hadoop-env.sh</span><br><span class="line">export HDFS_NAMENODE_USER&#x3D;root</span><br><span class="line">export HDFS_DATANODE_USER&#x3D;root</span><br><span class="line">export HDFS_SECONDARYNAMENODE_USER&#x3D;root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">再次执行：sbin&#x2F;start-dfs.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">[root@hadoop hadoop-3.2.2]# jps -l</span><br><span class="line">2066 org.apache.hadoop.hdfs.server.namenode.NameNode</span><br><span class="line">2418 org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode</span><br><span class="line">2202 org.apache.hadoop.hdfs.server.datanode.DataNode</span><br><span class="line">2542 sun.tools.jps.Jps</span><br><span class="line">[root@hadoop hadoop-3.2.2]# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">停止</span><br><span class="line">$ sbin&#x2F;stop-dfs.sh</span><br></pre></td></tr></table></figure>

<h3><span id="yarn-on-a-single-node">YARN on a Single Node</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">vi etc&#x2F;hadoop&#x2F;mapred-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.framework.name&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;yarn&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.application.classpath&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;$HADOOP_MAPRED_HOME&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;*:$HADOOP_MAPRED_HOME&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;lib&#x2F;*         &lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi etc&#x2F;hadoop&#x2F;yarn-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.aux-services&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;mapreduce_shuffle&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sbin&#x2F;start-yarn.sh</span><br><span class="line"></span><br><span class="line">Starting resourcemanager</span><br><span class="line">ERROR: Attempting to operate on yarn resourcemanager as root</span><br><span class="line">ERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting operation.</span><br><span class="line">Starting nodemanagers</span><br><span class="line">ERROR: Attempting to operate on yarn nodemanager as root</span><br><span class="line">ERROR: but there is no YARN_NODEMANAGER_USER defined. Aborting operation.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi etc&#x2F;hadoop&#x2F;yarn-env.sh</span><br><span class="line"></span><br><span class="line">export YARN_RESOURCEMANAGER_USER&#x3D;root</span><br><span class="line">export YARN_NODEMANAGER_USER&#x3D;root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sbin&#x2F;start-yarn.sh</span><br><span class="line"></span><br><span class="line">sbin&#x2F;start-dfs.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@hadoop hadoop-3.2.2]# jps -l</span><br><span class="line">3328 org.apache.hadoop.yarn.server.resourcemanager.ResourceManager</span><br><span class="line">4432 sun.tools.jps.Jps</span><br><span class="line">3956 org.apache.hadoop.hdfs.server.namenode.NameNode</span><br><span class="line">4118 org.apache.hadoop.hdfs.server.datanode.DataNode</span><br><span class="line">3466 org.apache.hadoop.yarn.server.nodemanager.NodeManager</span><br><span class="line">4317 org.apache.hadoop.hdfs.server.namenode.SecondaryNameNode</span><br><span class="line">[root@hadoop hadoop-3.2.2]#</span><br></pre></td></tr></table></figure>





<h1><span id="hadoop-cluster-setup">Hadoop Cluster Setup</span></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#各进程JVM参数修改</span><br><span class="line">etc&#x2F;hadoop&#x2F;mapred-env.sh</span><br><span class="line">etc&#x2F;hadoop&#x2F;yarn-env.sh</span><br><span class="line">etc&#x2F;hadoop&#x2F;hadoop-env.sh</span><br><span class="line"></span><br><span class="line">NameNode	HDFS_NAMENODE_OPTS</span><br><span class="line">DataNode	HDFS_DATANODE_OPTS</span><br><span class="line">Secondary NameNode	HDFS_SECONDARYNAMENODE_OPTS</span><br><span class="line">ResourceManager	YARN_RESOURCEMANAGER_OPTS</span><br><span class="line">NodeManager	YARN_NODEMANAGER_OPTS</span><br><span class="line">WebAppProxy	YARN_PROXYSERVER_OPTS</span><br><span class="line">Map Reduce Job History Server	MAPRED_HISTORYSERVER_OPTS</span><br><span class="line"></span><br><span class="line">#例如hadoop-env.sh</span><br><span class="line"></span><br><span class="line">export HDFS_NAMENODE_OPTS&#x3D;&quot;-XX:+UseParallelGC -Xmx4g&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#etc&#x2F;hadoop&#x2F;core-site.xml</span><br><span class="line">fs.defaultFS	NameNode URI	hdfs:&#x2F;&#x2F;host:port&#x2F;</span><br><span class="line">io.file.buffer.size	131072	Size of read&#x2F;write buffer used in SequenceFiles.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#etc&#x2F;hadoop&#x2F;hdfs-site.xml</span><br><span class="line">dfs.namenode.name.dir	</span><br><span class="line">Path on the local filesystem where the NameNode stores the namespace and transactions logs persistently.	If this is a comma-delimited list of directories then the name table is replicated in all of the directories, for redundancy.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dfs.hosts &#x2F; dfs.hosts.exclude	</span><br><span class="line">List of permitted&#x2F;excluded DataNodes.	If necessary, use these files to control the list of allowable datanodes.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dfs.blocksize	268435456	HDFS blocksize of 256MB for large file-systems.</span><br><span class="line">dfs.namenode.handler.count	100	More NameNode server threads to handle RPCs from large number of DataNodes.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dfs.datanode.data.dir  </span><br><span class="line">Comma separated list of paths on the local filesystem of a DataNode where it should store its blocks.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">etc&#x2F;hadoop&#x2F;yarn-site.xml</span><br><span class="line"></span><br><span class="line">yarn.acl.enable</span><br><span class="line">yarn.admin.acl</span><br><span class="line">yarn.log-aggregation-enable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yarn.resourcemanager.address</span><br><span class="line"></span><br><span class="line">yarn.resourcemanager.scheduler.address</span><br><span class="line"></span><br><span class="line">yarn.resourcemanager.resource-tracker.address</span><br><span class="line"></span><br><span class="line">yarn.resourcemanager.resource-tracker.address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yarn.resourcemanager.resource-tracker.address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yarn.resourcemanager.hostname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yarn.nodemanager.resource.memory-mb</span><br><span class="line"></span><br><span class="line">yarn.nodemanager.resource.memory-mb</span><br><span class="line"></span><br><span class="line">yarn.nodemanager.local-dirs</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[hdfs]$ $HADOOP_HOME&#x2F;sbin&#x2F;start-dfs.sh</span><br><span class="line"></span><br><span class="line">[yarn]$ $HADOOP_HOME&#x2F;sbin&#x2F;start-yarn.sh</span><br></pre></td></tr></table></figure>



<p>举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#配置免密</span><br><span class="line"></span><br><span class="line">配置&#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#关闭防火墙</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hadoop-env.sh</span><br><span class="line"></span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;src&#x2F;jdk1.8</span><br><span class="line">export HADOOP_LOG_DIR&#x3D;&#x2F;data&#x2F;hadoop_repo&#x2F;logs&#x2F;hadoop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">core-site.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;fs.defaultFS&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;hdfs:&#x2F;&#x2F;hadoop1:9000&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;hadoop.tmp.dir&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;&#x2F;data&#x2F;hadoop_repo&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hdfs-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;2&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.secondary.http-address&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;hadoop1:50090&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mapred-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.framework.name&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;yarn&lt;&#x2F;value&gt;</span><br><span class="line">    &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yarn-site.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.nodemanager.aux-services&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;value&gt;mapreduce_shuffle&lt;&#x2F;value&gt;</span><br><span class="line">  &lt;&#x2F;property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.nodemanager.env-whitelist&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;&#x2F;value&gt;</span><br><span class="line">  &lt;&#x2F;property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.hostname&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;value&gt;hadoop1&lt;&#x2F;value&gt;</span><br><span class="line">  &lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line">从节点的主机名</span><br><span class="line">vim &#x2F;opt&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F;workers</span><br><span class="line"></span><br><span class="line">hadoop2</span><br><span class="line">hadoop3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start-dfs.sh，stop-dfs.sh</span><br><span class="line">HDFS_DATANODE_USER&#x3D;root</span><br><span class="line">HDFS_DATANODE_SECURE_USER&#x3D;hdfs</span><br><span class="line">HDFS_NAMENODE_USER&#x3D;root</span><br><span class="line">HDFS_SECONDARYNAMENODE_USER&#x3D;root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start-yarn.sh，stop-yarn.sh</span><br><span class="line"></span><br><span class="line">YARN_RESOURCEMANAGER_USER&#x3D;root</span><br><span class="line">HADOOP_SECURE_DN_USER&#x3D;yarn</span><br><span class="line">YARN_NODEMANAGER_USER&#x3D;root</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">李宁</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李宁</span>
</div>
  <div class="powered-by">万物之始，大道至简
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">知易行难，悟在天成
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
