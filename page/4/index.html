<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"localhost","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="李宁的博客">
<meta property="og:url" content="http://localhost:4000/page/4/index.html">
<meta property="og:site_name" content="李宁的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="李宁">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://localhost:4000/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>李宁的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李宁的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/docker/" class="post-title-link" itemprop="url">Docker知识库</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#docker知识库">Docker知识库</a><ul>
<li><a href="#安装">安装</a></li>
<li><a href="#常用命令">常用命令</a></li>
<li><a href="#制作docker镜像">制作Docker镜像</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="docker知识库">Docker知识库</span></h2><h3><span id="安装">安装</span></h3><p>移除旧版  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep docker</span><br><span class="line">yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span><br></pre></td></tr></table></figure>

<p>安装依赖  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>



<p>阿里云</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">yum makecache fast</span><br><span class="line">yum -y install docker-ce</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;kqh8****.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">docker search nginx</span><br><span class="line"></span><br><span class="line">docker pull nginx:latest</span><br><span class="line"></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">docker run --name nginx-test -p 8080:80 -d nginx</span><br></pre></td></tr></table></figure>



<p>安装docker引擎  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p>启动Docker引擎  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>修改docker仓库地址  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"http://hub-mirror.c.163.com"</span>],</span><br><span class="line">&#125;</span><br><span class="line">或</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>:[<span class="string">"http://hub-mirror.c.163.com"</span>],</span><br><span class="line">  <span class="string">"storage-driver"</span>:<span class="string">"devicemapper"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>卸载docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker-ce</span><br><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>

<h3><span id="常用命令">常用命令</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker –version</span><br><span class="line">docker images</span><br><span class="line">docker ps -a 或 docker container ls –all</span><br><span class="line">docker seach java</span><br><span class="line">docker pull centos</span><br><span class="line">docker start 243c32535da7</span><br><span class="line">docker stop 243c32535da7</span><br><span class="line">docker restart 243c32535da7</span><br><span class="line">docker <span class="built_in">exec</span> -it 243c32535da7 /bin/bash</span><br><span class="line">docker rm -f 1e560fca3906</span><br><span class="line">docker logs -f bf08b7f2cd89</span><br><span class="line">docker top bf08b7f2cd89</span><br><span class="line">docker inspect bf08b7f2cd89</span><br><span class="line"></span><br><span class="line">移除镜像</span><br><span class="line">docker rmi centos</span><br><span class="line"></span><br><span class="line">复制文件  </span><br><span class="line">docker cp consumer-font:/etc/nginx/nginx.conf /home/up/nginx-consumer/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">启动容器</span><br><span class="line">docker run -p 7474:7474 -p 7687:7687 -v /home/neo4j/data:/data -v /home/neo4j/conf:/conf -v /home/neo4j/logs:/logs  --privileged=<span class="literal">true</span> --restart=always -d neo4j</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -p 8094:80 -v /home/up/nginx-consumer/www:/usr/share/nginx/html -v /home/up/nginx-consumer/conf/nginx.conf:/etc/nginx/nginx.conf:ro -v /home/up/nginx-consumer/logs:/var/<span class="built_in">log</span>/nginx --name consumer-font --privileged=<span class="literal">true</span> --restart=always -d nginx</span><br></pre></td></tr></table></figure>

<h3><span id="制作docker镜像">制作Docker镜像</span></h3><p>Dockerfile  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7.7.1908</span><br><span class="line">MAINTAINER <span class="string">"UnionPay"</span>&lt;datafusion@unionpay.com&gt;</span><br><span class="line">RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">ENV LANG en_US.UTF-8</span><br><span class="line">ENV LANGUAGE en_US.UTF-8</span><br><span class="line">ENV LC_ALL en_US.UTF-8</span><br><span class="line">ADD jdk-8u221-linux-x64.tar.gz /user/jdk/</span><br><span class="line">ENV JAVA_HOME /user/jdk/jdk1.8.0_221</span><br><span class="line">ENV PATH <span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">CMD java -version</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t datafusion/java:1.8 .</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM datafusion/java:1.8</span><br><span class="line">MAINTAINER <span class="string">"UnionPay"</span>datafusion@unionpay.com</span><br><span class="line">WORKDIR /opt</span><br><span class="line">COPY app.jar /opt</span><br><span class="line">CMD java -jar /opt/app.jar</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM datafusion/java:1.8</span><br><span class="line">MAINTAINER <span class="string">"UnionPay"</span>datafusion@unionpay.com</span><br><span class="line">RUN mkdir /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">VOLUME /app</span><br><span class="line">COPY app.jar /app</span><br><span class="line">EXPOSE 8080</span><br><span class="line">ENTRYPOINT  [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app/app.jar"</span>]</span><br></pre></td></tr></table></figure>

<p>宿主机创建目录 /app，将app.jar复制到/app</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v /app:/app datafusion/demo:mount</span><br></pre></td></tr></table></figure>

<p>注意这里是先挂载目录在启动容器</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/MySQL%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/MySQL%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">MySQL理论与实战</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#mysql理论与实战">MySQL理论与实战</a><ul>
<li><a href="#1-mysql安装">1. MySQL安装</a><ul>
<li><a href="#11-yum安装">1.1 Yum安装</a><ul>
<li><a href="#111-下载安装包">1.1.1 下载安装包</a></li>
<li><a href="#112-使用安装包添加mysql-yum-repository">1.1.2 使用安装包添加MySQL Yum Repository</a></li>
<li><a href="#113-安装mysql-server">1.1.3 安装MySQL Server</a></li>
<li><a href="#114-安装后信息">1.1.4 安装后信息</a></li>
<li><a href="#115-常用命令">1.1.5 常用命令</a></li>
</ul>
</li>
<li><a href="#12-二进制包安装待续">1.2 二进制包安装（待续）</a></li>
</ul>
</li>
<li><a href="#2-mysql认证与权限">2. MySQL认证与权限</a><ul>
<li><a href="#21-设置语言">2.1 设置语言</a></li>
<li><a href="#22-编辑网络">2.2 编辑网络</a></li>
<li><a href="#23-用户和组设置">2.3 用户和组设置</a></li>
<li><a href="#24-yum源设置">2.4 yum源设置</a></li>
<li><a href="#25-防火墙与selinux">2.5 防火墙与SElinux</a></li>
<li><a href="#26-系统优化">2.6 系统优化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="mysql理论与实战">MySQL理论与实战</span></h2><h3><span id="1-mysql安装">1. MySQL安装</span></h3><h4><span id="11-yum安装">1.1 Yum安装</span></h4><p><a href="https://dev.mysql.com/doc/" target="_blank" rel="noopener">MySQL官方教程</a>  </p>
<h6><span id="111-下载安装包">1.1.1 下载安装包</span></h6><p>本文使用CentOS 7，因此对应下载*<em>Red Hat Enterprise Linux 7 / Oracle Linux 7 *</em>版本的RPM包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dev.mysql.com/downloads/repo/yum/</span><br></pre></td></tr></table></figure>

<h6><span id="112-使用安装包添加mysql-yum-repository">1.1.2 使用安装包添加MySQL Yum Repository</span></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum repolist enabled | grep mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install yum-utils -y</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager --enable mysql80-community</span><br><span class="line"></span><br><span class="line">cd /etc/yum.repos.d/</span><br><span class="line"></span><br><span class="line">-rw-r--r--. 1 root root 2076 Apr  7 15:48 mysql-community.repo</span><br><span class="line">-rw-r--r--. 1 root root 2108 Apr 25  2019 mysql-community-source.repo</span><br><span class="line"></span><br><span class="line">或者手动新增的仓库内容mysql-community.repo</span><br><span class="line"></span><br><span class="line">[mysql80-community]</span><br><span class="line">name=MySQL 8.0 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-8.0-community/el/7/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line">[mysql-connectors-community]</span><br><span class="line">name=MySQL Connectors Community</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-connectors-community/el/7/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line">[mysql-tools-community]</span><br><span class="line">name=MySQL Tools Community</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-tools-community/el/7/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line">yum repolist enabled | grep mysql</span><br><span class="line"></span><br><span class="line">mysql-connectors-community/x86_64 MySQL Connectors Community                 185</span><br><span class="line">mysql-tools-community/x86_64      MySQL Tools Community                      123</span><br><span class="line">mysql80-community/x86_64          MySQL 8.0 Community Server                 229</span><br></pre></td></tr></table></figure>

<h6><span id="113-安装mysql-server">1.1.3  安装MySQL Server</span></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install mysql-community-server</span><br><span class="line"></span><br><span class="line">systemctl start mysqld</span><br><span class="line"></span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure>

<h6><span id="114-安装后信息">1.1.4 安装后信息</span></h6><p>默认的数据目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;mysql</span><br></pre></td></tr></table></figure>

<p>默认的数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">information_schema</span><br><span class="line">mysql</span><br><span class="line">performance_schema</span><br><span class="line">sys</span><br></pre></td></tr></table></figure>

<p>默认的root用户密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grep 'temporary password' /var/log/mysqld.log</span><br></pre></td></tr></table></figure>

<p>登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -h127.0.0.1 -P3306 -p</span><br></pre></td></tr></table></figure>

<p>修改初始密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;app_!QAZxsw2&#39;;</span><br></pre></td></tr></table></figure>

<h6><span id="115-常用命令">1.1.5 常用命令</span></h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">database</span>();</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line"><span class="keyword">use</span> mysql;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="keyword">describe</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>\G</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">limit</span> <span class="number">1</span> \G</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">warnings</span>;</span><br></pre></td></tr></table></figure>



<h4><span id="12-二进制包安装待续">1.2  二进制包安装（待续）</span></h4><h3><span id="2-mysql认证与权限">2. MySQL认证与权限</span></h3><h4><span id="21-设置语言">2.1 设置语言</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/zh_CN.UTF-8/en_US.UTF-8/'</span> /etc/locale.conf</span><br><span class="line"><span class="built_in">source</span> /etc/locale.conf</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/locale.conf</span><br><span class="line">LANG=<span class="string">"en_US.UTF-8"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/locale.conf</span><br></pre></td></tr></table></figure>



<h4><span id="22-编辑网络">2.2 编辑网络</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts</span><br><span class="line">vi ifcfg-ens33</span><br></pre></td></tr></table></figure>

<p>IP配置如下  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.67.10</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.67.2</span><br><span class="line">IPV6_PRIVACY=no</span><br><span class="line">DNS1=144.144.144.144</span><br><span class="line">DNS2=8.8.8.8</span><br></pre></td></tr></table></figure>

<p>DNS设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> nameserver 8.8.8.8 &gt; /etc/resolv.conf</span><br><span class="line"><span class="built_in">echo</span> nameserver 144.144.144.144 &gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>重启网卡  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<p>主机名FQDN（Fully Qualified Domain Name）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname master01</span><br><span class="line"></span><br><span class="line">more &#x2F;etc&#x2F;hostname</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hostnamectl --static set-hostname node130.unionpay.com</span><br><span class="line"></span><br><span class="line">验证修改是否生效</span><br><span class="line">hostname -f</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line">192.168.67.130 node130.unionpay.com</span><br></pre></td></tr></table></figure>

<p>验证Mac和UUID 确保唯一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;sys&#x2F;class&#x2F;net&#x2F;ens160&#x2F;address</span><br><span class="line"></span><br><span class="line">cat &#x2F;sys&#x2F;class&#x2F;dmi&#x2F;id&#x2F;product_uuid</span><br></pre></td></tr></table></figure>



<p>防火墙设置  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#centos7启动防火墙</span><br><span class="line">systemctl start firewalld.service</span><br><span class="line">#centos7停止防火墙&#x2F;关闭防火墙</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">#centos7重启防火墙</span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line"> </span><br><span class="line">#设置开机启用防火墙</span><br><span class="line">systemctl enable firewalld.service</span><br><span class="line">#设置开机不启动防火墙</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">firewall-cmd  --zone=public  --add-port=8089/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line">firewall-cmd  --zone=public  --remove-port=8089/tcp --permanent</span><br></pre></td></tr></table></figure>

<h4><span id="23-用户和组设置">2.3 用户和组设置</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -s /bin/bash -d /home/lining -m lining</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd lining</span><br></pre></td></tr></table></figure>

<p>-s 指定用户登入后所使用的shell<br>-d 指定用户登入时的起始目录<br>-m 自动建立用户的登入目录<br>-g 指定用户所属的群组<br>-G 指定用户所属的附加群组  </p>
<p>添加sudo权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"lining ALL=(ALL) NOPASSWD: ALL"</span> | sudo tee /etc/sudoers.d/lining</span><br></pre></td></tr></table></figure>

<p>删除用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel -r lining</span><br></pre></td></tr></table></figure>

<p>修改用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $USER &amp;&amp; newgrp docker</span><br></pre></td></tr></table></figure>



<h4><span id="24-yum源设置">2.4 yum源设置</span></h4><p>Base和EPEL源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget</span><br><span class="line">mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo_bak</span><br><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class="line">wget https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo</span><br><span class="line"></span><br><span class="line"># 清除缓存并生成新的缓存</span><br><span class="line">yum clan all</span><br><span class="line">yum makecache</span><br><span class="line">#查看可用的源仓库</span><br><span class="line">yum repolist</span><br><span class="line"></span><br><span class="line">#验证安装</span><br><span class="line">yum install -y net-tools</span><br></pre></td></tr></table></figure>



<h4><span id="25-防火墙与selinux">2.5  防火墙与SElinux</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i &#39;s&#x2F;^ *SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line"></span><br><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure>



<h4><span id="26-系统优化">2.6 系统优化</span></h4><p>禁用swap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a</span><br><span class="line">sed -i.bak &#39;&#x2F;swap&#x2F;s&#x2F;^&#x2F;#&#x2F;&#39; &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free -m</span><br></pre></td></tr></table></figure>

<p>文件句柄</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line"></span><br><span class="line">elasticsearch        hard     nofile         65535</span><br><span class="line">elasticsearch        soft     nofile         65535</span><br><span class="line"></span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nofile 65535</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">vm.max_map_count &#x3D; 262144</span><br></pre></td></tr></table></figure>



<p>2.7  SSH</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.27.34.4</span><br></pre></td></tr></table></figure>



<p>2.8 其他</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#查系统以及内核信息</span><br><span class="line">uname -a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;version</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;cpuinfo</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;meminfo</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;centos-release</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/Hadoop%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/Hadoop%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">Hadoop源码编译</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#hadoop源码编译">Hadoop源码编译</a></li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="hadoop源码编译">Hadoop源码编译</span></h2><p>下载源码  </p>
<p>准备虚拟机环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#设置IP地址</span></span><br><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts</span><br><span class="line">vi ifcfg-ens33</span><br><span class="line"></span><br><span class="line">TYPE=<span class="string">"Ethernet"</span></span><br><span class="line">PROXY_METHOD=<span class="string">"none"</span></span><br><span class="line">BROWSER_ONLY=<span class="string">"no"</span></span><br><span class="line">BOOTPROTO=<span class="string">"static"</span></span><br><span class="line">DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6INIT=<span class="string">"yes"</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">"yes"</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">"stable-privacy"</span></span><br><span class="line">NAME=<span class="string">"ens33"</span></span><br><span class="line">UUID=<span class="string">"1b6cb313-debd-43ee-be56-e925bbb5b1b2"</span></span><br><span class="line">DEVICE=<span class="string">"ens33"</span></span><br><span class="line">ONBOOT=<span class="string">"yes"</span></span><br><span class="line">IPADDR=<span class="string">"192.168.67.21"</span></span><br><span class="line">PREFIX=<span class="string">"24"</span></span><br><span class="line">GATEWAY=<span class="string">"192.168.67.2"</span></span><br><span class="line">IPV6_PRIVACY=<span class="string">"no"</span></span><br><span class="line">DNS1=<span class="string">"114.114.114.114"</span></span><br><span class="line"></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line">systemctl status network</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置域名</span></span><br><span class="line">hostnamectl --static <span class="built_in">set</span>-hostname hadoop</span><br><span class="line">hostname -f</span><br><span class="line"></span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.67.21 hadoop</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭SELinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y wget</span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line">yum clan all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>

<p>软件安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#JDK </span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -zxvf jdk-8u221-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#JCE</span></span><br><span class="line">unzip jce_policy-8.zip</span><br><span class="line">cp /opt/UnlimitedJCEPolicyJDK8/local_policy.jar /opt/jdk1.8.0_221/jre/lib/security</span><br><span class="line">cp /opt/UnlimitedJCEPolicyJDK8/US_export_policy.jar /opt/jdk1.8.0_221/jre/lib/security</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">unzip -oj -d /opt/jdk1.8.0_221/jre/lib/security/ /opt/jce_policy-8.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.5以上的JDK不用设置CLASS_PATH</span></span><br><span class="line"><span class="comment">#如果要设置，则export CLASS_PATH=.:$JAVA_HOME/lib/:$CLASS_PATH</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/jdk1.8.0_221</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"><span class="comment">#Maven</span></span><br><span class="line"></span><br><span class="line">unzip apache-maven-3.6.3-bin.zip</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> MAVEN_HOME=/opt/apache-maven-3.6.3</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$MAVEN_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">mvn -v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /opt/apache-maven-3.6.3/conf</span><br><span class="line"></span><br><span class="line">vi setting.xml</span><br><span class="line"></span><br><span class="line">&lt;localRepository&gt;/opt/maven/repo&lt;/localRepository&gt;</span><br><span class="line"></span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">  &lt;id&gt;aliyunmaven&lt;/id&gt;</span><br><span class="line">  &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;</span><br><span class="line">  &lt;name&gt;阿里云公共仓库&lt;/name&gt;</span><br><span class="line">  &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;</span><br><span class="line">&lt;/mirror&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Cmake  cmake_minimum_required(VERSION 3.1 FATAL_ERROR)</span></span><br><span class="line">yum -y install gcc g++ </span><br><span class="line">yum -y install gcc-c++</span><br><span class="line">yum -y install autoconf automake libtool curl</span><br><span class="line">yum -y install lzo-devel zlib-devel openssl openssl-devel ncurses-devel</span><br><span class="line">yum -y install snappy snappy-devel bzip2 bzip2-devel lzo lzo-devel lzop libXtst</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /opt/cmake-3.19.2</span><br><span class="line"></span><br><span class="line">./bootstrap</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">cmake -version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#protobuf</span></span><br><span class="line">unzip protobuf-2.5.0.zip</span><br><span class="line"><span class="built_in">cd</span> /opt/protobuf-2.5.0</span><br><span class="line">./configure --prefix=/opt/protobuf-2.5.0</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">ln -s /opt/protobuf-2.5.0/bin/protoc /usr/bin/protoc</span><br><span class="line"></span><br><span class="line">protoc --version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tar -zxvf hadoop-3.3.0-src.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> hadoop-3.3.0-src</span><br><span class="line">mvn -X clean package -DskipTests -Pdist,native -Dtar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这里编译hdfs-native-client: CMake failed with error code 1</span><br><span class="line"></span><br><span class="line">进入/opt/hadoop-3.3.0-src/hadoop-hdfs-project</span><br><span class="line">单独编译</span><br><span class="line">/opt/hadoop-3.3.0-src/hadoop-hdfs-project/hadoop-hdfs-native-client</span><br><span class="line"></span><br><span class="line">升级：yum install -y zlib* libssl*</span><br><span class="line"></span><br><span class="line">yum install -y tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line">mvn -X clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment">#-DskipTests，不执行测试用例，但编译测试用例类生成相应的class文件至target/test-classes下。</span></span><br><span class="line"><span class="comment">#-Dmaven.test.skip=true，不执行测试用例，也不编译测试用例类。</span></span><br><span class="line">mvn package -DskipTests -Pdist,native -Dtar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单独编译</span><br><span class="line">手动下载node 替换掉仓库中的，然后手动解压</span><br><span class="line"><span class="comment">#https://nodejs.org/dist/v8.11.3/</span></span><br><span class="line">/opt/maven/repo/com/github/eirslett/node/8.11.3</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /opt/hadoop-3.3.0-src/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-catalog/hadoop-yarn-applications-catalog-webapp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#编译过程中出现了编译hadoop-hdfs-native-client失败和hadoop-yarn-applications-catalog-webapp失败</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可分别进入子目录单独编译</span></span><br><span class="line">mvn package -DskipTests</span><br><span class="line"><span class="comment">#最后进入最外层单独编译  </span></span><br><span class="line">执行不过：mvn package -DskipTests -Pdist,native -Dtar   </span><br><span class="line">执行通过：mvn package -DskipTests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">未解决</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/" class="post-title-link" itemprop="url">负载均衡与高可用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">负载均衡与高可用</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#负载均衡的选择">负载均衡的选择</a><ul>
<li><a href="#4层tcp负载">4层（TCP）负载</a></li>
</ul>
</li>
<li><a href="#7层http负载">7层（HTTP）负载</a></li>
<li><a href="#ssl问题">SSL问题</a></li>
<li><a href="#haproxy与nginx">Haproxy与Nginx</a></li>
<li><a href="#lvs">LVS</a><ul>
<li><a href="#基于nat的lvs">基于NAT的LVS</a></li>
<li><a href="#基于tun的lvs">基于TUN的LVS</a></li>
<li><a href="#基于dr的lvs">基于DR的LVS</a></li>
</ul>
</li>
<li><a href="#squid">Squid</a></li>
<li><a href="#nginx">Nginx</a></li>
<li><a href="#haproxy">HAProxy</a><ul>
<li><a href="#haproxy安装">HAProxy安装</a></li>
</ul>
</li>
<li><a href="#keepalived">Keepalived</a><ul>
<li><a href="#keepalived-1">Keepalived</a><ul>
<li><a href="#虚拟路由冗余协议">虚拟路由冗余协议</a></li>
<li><a href="#keepalived安装">Keepalived安装</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h4><span id="负载均衡的选择">负载均衡的选择</span></h4><p>根据流量的情况与复杂度，选择使用用第4层或第7层这两种负载均衡方案，这两种是针对不同场景的方案，所以在对负载均衡设备配置决策之前，需要清楚自己的需求很重要。</p>
<p>4层：LVS Haproxy Nginx<br>7层：Haproxy Nginx<br>硬件：F5</p>
<h5><span id="4层tcp负载">4层（TCP）负载</span></h5><p>优点：它是通过修改每个分组报头的目地IP和MAC地址部分，然后将其转发到可用的服务器节点之一，4层负载处理速度比7层快。<br>缺点：4层负载也有缺点，灵活性较差，且要求每个服务器都要部署相同的应用组件。</p>
<p>适用于功能简单不太复杂的应用</p>
<h4><span id="7层http负载">7层（HTTP）负载</span></h4><p>使用7层负载平衡，可能需要更多的计算能力来处理，比如较高的CPU和内存，但它为大型和复杂的网站提供的回报是值得付出的。7层负载均衡类型允许我们把每个组件分离到不同的服务器上，而且这些机器亦对用户透明。</p>
<h4><span id="ssl问题">SSL问题</span></h4><p>4层负载：若是SSL数据包直接扔给给应用服务器，它只是做转发。<br>7层负载：SSL在负载平衡设备上进行处理</p>
<h4><span id="haproxy与nginx">Haproxy与Nginx</span></h4><p>HAProxyCPU和内存占用极小，这意味着它可以媲美硬件。对于大多数情况，HAProxy是一个非常合适的选择如果你需要更多的能力和灵活性，可以选择Nginx，虽然Nginx占用的内存和CPU略高一些。</p>
<h4><span id="lvs">LVS</span></h4><h5><span id="基于nat的lvs">基于NAT的LVS</span></h5><h5><span id="基于tun的lvs">基于TUN的LVS</span></h5><h5><span id="基于dr的lvs">基于DR的LVS</span></h5><h4><span id="squid">Squid</span></h4><p>常用于正向代理，是一款web缓存代理软件，缓存呢绒常放于内存或者磁盘，因此对内存或者磁盘的性能要求较高Nvme SSD</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install squid</span><br><span class="line">systemctl start squid</span><br><span class="line">systemctl <span class="built_in">enable</span> squid</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/squid/squid.conf</span><br></pre></td></tr></table></figure>


<h4><span id="nginx">Nginx</span></h4><p>Nginx可以作为后端的HTTP服务器，也可以作为反向代理和负载均衡服务器，Nginx可以提供基于七层的负载均衡方案，可以使用轮询、IP哈希、URL哈希等方式调度后端服务器，同时支持对后端服务器的健康检查。</p>
<p>正向代理：代理的是客户端 squid，正向代理中，proxy和client同属一个LAN，对server透明。正向代理用途是为了在防火墙内的局域网提供访问internet的途径。另外还可以使用缓冲特性减少网络使用率<br>反向代理：代理的是服务端 nginx，反向代理中，proxy和server同属一个LAN，对client透明。反向代理的用途是将防火墙后面的服务器提供给internet用户访问。同时还可以完成诸如负载均衡等功能</p>
<p>使用Vmvare为虚拟机添加两张网卡，Nginx一般添加两个Ip，一个外网IP，另一个内网IP.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ip addr</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/</span><br><span class="line"></span><br><span class="line">cp ifcfg-ens33 ifcfg-ens37</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi ifcfg-ens37</span><br><span class="line">修改Ip，网卡名字，UUID等信息</span><br></pre></td></tr></table></figure>

<p>安装httpd服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum -y install httpd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.67.26"</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line">其中修改httpd的端口</span><br><span class="line">vi /etc/httpd/conf/httd.conf </span><br><span class="line"></span><br><span class="line">systemctl start httpd</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> httpd</span><br></pre></td></tr></table></figure>

<p>安装Nginx服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yum -y install gcc pcre pcre-devel openssl openssl-devel zlib-devel gd gd-devel perl perl-ExtUtils-Embed</span><br><span class="line"></span><br><span class="line">tar -zxvf nginx-1.17.9.tar.gz -C /usr/src/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/src/nginx-1.17.9</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx --with-ipv6 \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_addition_module \</span><br><span class="line">--with-http_dav_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_mp4_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_perl_module \</span><br><span class="line">--with-mail \</span><br><span class="line">--with-mail_ssl_module</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">    error_log  logs/error.log  notice;</span><br><span class="line">    pid        logs/nginx.pid;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">    supstream servers &#123;</span><br><span class="line">        server 192.168.67.24:8080 max_fails=3 fail_timeout=30s weight=2;</span><br><span class="line">        server 192.168.67.26:8080 max_fails=3 fail_timeout=30s weight=2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  192.168.67.25;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://servers;</span><br><span class="line">            proxy_cache one;</span><br><span class="line">            proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动Nginx</span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tailf /usr/<span class="built_in">local</span>/nginx/logs/error.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">重新加载配置/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>

<p>添加开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /lib/systemd/system/</span><br><span class="line">vi nginx.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx service</span><br><span class="line">After=network.target </span><br><span class="line">   </span><br><span class="line">[Service] </span><br><span class="line">Type=forking </span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=<span class="literal">true</span> </span><br><span class="line">   </span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure>
<p>开放Nginx端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd  --zone=public  --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd  --zone=public  --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>

<p>移除应用端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd  --zone=public  --remove-port=8099/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>

<h4><span id="haproxy">HAProxy</span></h4><h5><span id="haproxy安装">HAProxy安装</span></h5><p>yum安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install haproxy</span><br><span class="line"></span><br><span class="line">vi /etc/haproxy/haproxy.cfg</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"><span class="variable">$ModLoad</span> imudp</span><br><span class="line"><span class="variable">$UDPServerRun</span> 514</span><br><span class="line"></span><br><span class="line">local2.*                       /var/<span class="built_in">log</span>/haproxy.log</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Example configuration for a possible web application.  See the</span></span><br><span class="line"><span class="comment"># full configuration options online.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   http://haproxy.1wt.eu/download/1.4/doc/configuration.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Global settings</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">global</span><br><span class="line">    <span class="comment"># to have these messages end up in /var/log/haproxy.log you will</span></span><br><span class="line">    <span class="comment"># need to:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 1) configure syslog to accept network log events.  This is done</span></span><br><span class="line">    <span class="comment">#    by adding the '-r' option to the SYSLOGD_OPTIONS in</span></span><br><span class="line">    <span class="comment">#    /etc/sysconfig/syslog</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 2) configure local2 events to go to the /var/log/haproxy.log</span></span><br><span class="line">    <span class="comment">#   file. A line like the following can be added to</span></span><br><span class="line">    <span class="comment">#   /etc/sysconfig/syslog</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#    local2.*                       /var/log/haproxy.log</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="built_in">log</span>         127.0.0.1 local2</span><br><span class="line"></span><br><span class="line">    chroot      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line">    debug</span><br><span class="line">    <span class="comment"># turn on stats unix socket</span></span><br><span class="line">    stats socket /var/lib/haproxy/stats</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># common defaults that all the 'listen' and 'backend' sections will</span></span><br><span class="line"><span class="comment"># use if not designated in their block</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           1m</span><br><span class="line">    timeout connect         10s</span><br><span class="line">    timeout client          1m</span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># main frontend which proxys to the backends</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">frontend  http-in</span><br><span class="line">    <span class="built_in">bind</span> *:80</span><br><span class="line">    stats uri /haproxy/stats</span><br><span class="line">    acl healthpro url_beg /up/health/getSystemEnums</span><br><span class="line">    acl healthtest url_beg /up/health/isAuth</span><br><span class="line">    use_backend static <span class="keyword">if</span> healthpro</span><br><span class="line">    use_backend app <span class="keyword">if</span> healthtest</span><br><span class="line">    default_backend  app</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># static backend for serving up images, stylesheets and such</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">backend static</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      node1     192.168.67.130:8096</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># round robin balancing between the various backends</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">backend app</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      srv1     192.168.67.130:8095</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">    chroot      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line">    stats socket /var/lib/haproxy/stats</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    timeout connect         5000ms</span><br><span class="line">    timeout client          50000ms</span><br><span class="line">    timeout server          50000ms</span><br><span class="line">frontend http-in</span><br><span class="line">    <span class="built_in">bind</span> *:80</span><br><span class="line">    default_backend servers</span><br><span class="line"></span><br><span class="line">acl badboys src 192.168.0.0/24</span><br><span class="line">acl example_acl hdr_reg(host) -i ^(www.example.com|web.example.com)$</span><br><span class="line">block <span class="keyword">if</span> badboys</span><br><span class="line">use_backend servers_2 <span class="keyword">if</span> example_acl</span><br><span class="line">    default_backend servers_1</span><br><span class="line">backend servers_1</span><br><span class="line">    server server1 127.0.0.1:8000 maxconn 32</span><br><span class="line">backend servers_2</span><br><span class="line">    server server1 127.0.0.1:8000 maxconn 3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">检查配置文件</span><br><span class="line">haproxy -c -f /etc/haproxy/haproxy.cfg</span><br><span class="line"></span><br><span class="line">systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">重启加载配置文件</span><br><span class="line">haproxy -f /etc/haproxy/haproxy.cfg</span><br></pre></td></tr></table></figure>


<p>编译安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4><span id="keepalived">Keepalived</span></h4><p>Keepalived是一款基于Linux的负载均衡以及高可用软件。</p>
<h5><span id="keepalived">Keepalived</span></h5><p>Keepalived通过虚拟路由冗余协议(Virtual Router Redundancy Protocol，VRRP)实现高可用架构，通过IP虚拟服务器（IP Virtual Server，IPVS）实现负载均衡，实际生产环境中往往使用Keepalived实现高可用。  </p>
<h6><span id="虚拟路由冗余协议">虚拟路由冗余协议</span></h6><p>VRRP是路由灾备的实现基础，VRRP实现再主设备发生故障时将业务自动切换到从设备，对用户是透明的。VRRP将两台或者多台路由设备虚拟成一个设备，对外仅提供一个虚拟的路由IP地址（Virtual IP, VIP）,同一时刻有且只有一台主设备拥有该IP，其它的成为从设备</p>
<p>案列（1）<br>一个局域网络内的所有主机都设置缺省网关，这样主机发出的目的地址不在本网段的报文将被通过缺省网关发往三层交换机，从而实现了主机和外部网络的通信。当缺省路由器down掉（即端口关闭）之后，内部主机将无法与外部通信，如果路由器设置了VRRP时，那么这时，虚拟路由将启用备份路由器，从而实现全网通信。  </p>
<p>主从选择：<br>VRRP为每一个路由设备定义一个虚拟路由ID(VRID)以及设备优先级别（0~255），所有主路由设备的BRID必须一样并组成一个虚拟路由设备组，组内的路由设备有限级别高的会被选为主路由设备，优先级相等的IP地址越大优先级越高。如果VIP地址设置为某个主路由的设备的地址，那么该设备永远处于主设备状态。  </p>
<h6><span id="keepalived安装">Keepalived安装</span></h6><p>安装包安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc openssl-devel popt-devel libnl libnl-devel kernel-devel ipvsadm</span><br><span class="line"></span><br><span class="line">tar -zxvf keepalived-2.0.20.tar.gz -C /usr/src/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/src/keepalived-2.0.20</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/etc/keepalived/ /etc</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/etc/rc.d/init.d/keepalived /etc/init.d/</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/etc/sysconfig/keepalived /etc/sysconfig/</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/sbin/keepalived /usr/sbin</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/keepalived</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/keepalived/etc/keepalived/conf /etc/keepalived</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/keepalived/sbin/keepalived /usr/sbin/keepalived</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/keepalived/rc.d/init.d/keepalived /etc/init.d/</span><br></pre></td></tr></table></figure>

<p>yum源安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install keepalived</span><br><span class="line">vi /etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     liningwonder@153.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from lining@unionpaysmart.com</span><br><span class="line">   smtp_server smtp.qiye.163.com</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id nginx_master</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id 66</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.67.200</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     liningwonder@153.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from lining@unionpaysmart.com</span><br><span class="line">   smtp_server smtp.qiye.163.com</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id nginx_slave</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id 66</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.67.200</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Nginx检查脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#检测nginx是否启动了</span></span><br><span class="line">A=`ps -C nginx --no-header |wc -l`        </span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$A</span> -eq 0 ];<span class="keyword">then</span>    <span class="comment">#如果nginx没有启动就启动nginx                        </span></span><br><span class="line">      systemctl restart nginx                <span class="comment">#重启nginx</span></span><br><span class="line">      <span class="keyword">if</span> [ `ps -C nginx --no-header |wc -l` -eq 0 ];<span class="keyword">then</span>    <span class="comment">#nginx重启失败，则停掉keepalived服务，进行VIP转移</span></span><br><span class="line">              systemctl stop keepalived                    </span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>



<p>Niginx需要监听虚拟IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server_name  192.168.67.200;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/CentOS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/CentOS/" class="post-title-link" itemprop="url">CentOS</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CentOS/" itemprop="url" rel="index"><span itemprop="name">CentOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#centos基操">Centos基操</a><ul>
<li><a href="#1-官网资料">1. 官网资料</a><ul>
<li><a href="#11-操作系统镜像">1.1 操作系统镜像</a></li>
<li><a href="#12-安装教程">1.2 安装教程</a></li>
</ul>
</li>
<li><a href="#2-操作系统设置与优化">2. 操作系统设置与优化</a><ul>
<li><a href="#21-设置语言">2.1 设置语言</a></li>
<li><a href="#22-编辑网络">2.2 编辑网络</a></li>
<li><a href="#23-用户和组设置">2.3 用户和组设置</a></li>
<li><a href="#24-yum源设置">2.4 yum源设置</a></li>
<li><a href="#25-防火墙与selinux">2.5 防火墙与SElinux</a></li>
<li><a href="#26-系统优化">2.6 系统优化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="centos基操">Centos基操</span></h2><h3><span id="1-官网资料">1. 官网资料</span></h3><h4><span id="11-操作系统镜像">1.1 操作系统镜像</span></h4><p><a href="https://www.centos.org/centos-linux/" target="_blank" rel="noopener">https://www.centos.org/centos-linux/</a></p>
<p>CentOS 7 2003 系统下载站点：<a href="http://isoredirect.centos.org/centos/7/isos/x86_64/" target="_blank" rel="noopener">http://isoredirect.centos.org/centos/7/isos/x86_64/</a></p>
<p>清华站点：<a href="http://mirrors.tuna.tsinghua.edu.cn/centos/7.8.2003/isos/x86_64/" target="_blank" rel="noopener">http://mirrors.tuna.tsinghua.edu.cn/centos/7.8.2003/isos/x86_64/</a></p>
<p>阿里云站点：<a href="http://mirrors.aliyun.com/centos/7.8.2003/isos/x86_64/" target="_blank" rel="noopener">http://mirrors.aliyun.com/centos/7.8.2003/isos/x86_64/</a></p>
<p>华为云站点：<a href="http://mirrors.huaweicloud.com/centos/7.8.2003/isos/x86_64/" target="_blank" rel="noopener">http://mirrors.huaweicloud.com/centos/7.8.2003/isos/x86_64/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;centos&#x2F;7.8.2003&#x2F;isos&#x2F;x86_64&#x2F;CentOS-7-x86_64-DVD-2003.iso</span><br></pre></td></tr></table></figure>



<h4><span id="12-安装教程">1.2 安装教程</span></h4><p><a href="https://docs.centos.org/en-US/centos/install-guide/" target="_blank" rel="noopener">https://docs.centos.org/en-US/centos/install-guide/</a></p>
<p>磁盘分区：</p>
<p>系统盘 共 40G</p>
<p>Filesystem      Size  Used Avail Use% Mounted on<br>/dev/vda1        20G  7.7G   11G  42% /<br>devtmpfs         16G     0   16G   0% /dev<br>tmpfs            16G   12K   16G   1% /dev/shm<br>tmpfs            16G  8.7M   16G   1% /run<br>tmpfs            16G     0   16G   0% /sys/fs/cgroup<br>tmpfs           3.0G     0  3.0G   0% /run/user/0</p>
<p>磁盘分区与挂载</p>
<p>MBR  : 一块盘最多4个主分区、无法创建大于2TB的分区，单个磁盘驱动器上最多只能定义12个逻辑分区</p>
<p>最多4个主分区，可以现创建3个主分区，然后创建1个扩展分区，然后再再扩展分区中船舰逻辑分区（分区编号从5开始）</p>
<p>查看磁盘分区列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;vda: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units &#x3D; sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0000d5d0</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">&#x2F;dev&#x2F;vda1   *        2048    41943006    20970479+  83  Linux</span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;vdb: 85.9 GB, 85899345920 bytes, 167772160 sectors</span><br><span class="line">Units &#x3D; sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fdisk &#x2F;dev&#x2F;vdb</span><br><span class="line"></span><br><span class="line">n 新建分区</span><br><span class="line">p 创建主分区（1-4）</span><br><span class="line">1 输入编号 1  </span><br><span class="line">first sector 2048  回车默认从2048扇区开始分区</span><br><span class="line">last sector  +2G   大小,创建2GB大小的分区</span><br><span class="line">p 显示是否创建成功</span><br><span class="line"></span><br><span class="line">n 新建分区</span><br><span class="line">e 创建扩展分区</span><br><span class="line">2 输入编号 2  </span><br><span class="line">first sector default  回车从默认扇区开始分区</span><br><span class="line">last sector  default  大小,剩余大小的分区</span><br><span class="line"></span><br><span class="line">n 新建分区</span><br><span class="line">l 创建逻辑  </span><br><span class="line">first sector default  回车从默认扇区开始分区</span><br><span class="line">last sector  +2G   大小,创建2GB大小的分区</span><br><span class="line">p 显示是否创建成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d 删除分区</span><br><span class="line">5 分区编号</span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">w 保存并退出</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#格式化</span><br><span class="line">mkfs.xfs &#x2F;dev&#x2F;vdb1</span><br><span class="line"></span><br><span class="line">mkswap &#x2F;dev&#x2F;vdb2</span><br><span class="line"></span><br><span class="line">#挂载</span><br><span class="line">mkdir &#x2F;data</span><br><span class="line">mount &#x2F;dev&#x2F;vdb1 &#x2F;data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#立刻读取分区表</span><br><span class="line">partprobe &#x2F;dev&#x2F;vdb</span><br><span class="line"></span><br><span class="line">#自动挂载</span><br><span class="line">vi &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># &#x2F;etc&#x2F;fstab</span><br><span class="line"># Created by anaconda on Wed Jul 26 12:22:11 2017</span><br><span class="line">#</span><br><span class="line"># Accessible filesystems, by reference, are maintained under &#39;&#x2F;dev&#x2F;disk&#39;</span><br><span class="line"># See man pages fstab(5), findfs(8), mount(8) and&#x2F;or blkid(8) for more info</span><br><span class="line">#</span><br><span class="line">UUID&#x3D;16ccc04f-572a-4455-ba5b-2df9816e7ead &#x2F;                       ext4    defaults        1 1</span><br><span class="line"></span><br><span class="line">磁盘设备文件或者该设备的Label或者UUID     使用 dumpe2fs -h &#x2F;dev&#x2F;sda1  查看  blkid &#x2F;dev&#x2F;sda1</span><br><span class="line"></span><br><span class="line">使用设备名称来挂载分区时要担心插槽顺序，不用担心插槽顺序，使用uuid挂载的话就不用担心会发生错乱的问题</span><br><span class="line"></span><br><span class="line">defaults  具有rw,suid,dev,exec,auto,nouser,async等默认参数的设置</span><br><span class="line">1 能否被dump备份命令作用 </span><br><span class="line">1 是否检验扇区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># &#x2F;etc&#x2F;fstab</span><br><span class="line"># Created by anaconda on Wed Jun 24 01:35:21 2020</span><br><span class="line">#</span><br><span class="line"># Accessible filesystems, by reference, are maintained under &#39;&#x2F;dev&#x2F;disk&#39;</span><br><span class="line"># See man pages fstab(5), findfs(8), mount(8) and&#x2F;or blkid(8) for more info</span><br><span class="line">#</span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-root &#x2F;                       xfs     defaults        0 0</span><br><span class="line">UUID&#x3D;0db96dd4-a0a0-4fd2-88c1-d383179f5480 &#x2F;boot                   xfs     defaults        0 0</span><br><span class="line">&#x2F;dev&#x2F;mapper&#x2F;centos-swap swap                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>



<p>第一块磁盘 /dev/vda 共21.5G大小，第1块磁盘有1个分区，大小 41943006 - 2048 = </p>
<p>第二块磁盘/dev/vdb共85.9 GB，未分区</p>
<p>GPT分区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#修改分区表格式</span><br><span class="line">parted &#x2F;dev&#x2F;vdb mklabel gpt   </span><br><span class="line"></span><br><span class="line">#查看</span><br><span class="line">parted &#x2F;dev&#x2F;vdb print</span><br><span class="line"></span><br><span class="line">#从第1M开始分区，大小2G，文件系统为etx3</span><br><span class="line">parted &#x2F;dev&#x2F;vdb mkpart primary ext3 1 2G</span><br><span class="line"></span><br><span class="line">parted &#x2F;dev&#x2F;vdb mkpart primary ext3 2G 4G</span><br><span class="line"></span><br><span class="line">#删除分区</span><br><span class="line">parted &#x2F;dev&#x2F;vdb rm 2</span><br></pre></td></tr></table></figure>





<p>LVM</p>
<p>PV 物理卷 磁盘分区划分物理卷</p>
<p>VG 卷组  多个物理卷</p>
<p>LV 从卷组中取多少俩创建卷组</p>
<p>将普通分区转换为物理卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pvcreate &#x2F;dev&#x2F;sdb1 &#x2F;dev&#x2F;sdb2 &#x2F;dev&#x2F;sdb3</span><br><span class="line"></span><br><span class="line">pvcreate &#x2F;dev&#x2F;sdb&#123;1,2,3&#125;</span><br></pre></td></tr></table></figure>

<p>将物理卷转换为卷组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vgcreate test_vg1 &#x2F;dev&#x2F;sdb5 &#x2F;dev&#x2F;sdb6</span><br><span class="line"></span><br><span class="line">vgcreate test_vg2 -s 16M &#x2F;dev&#x2F;sdc5 &#x2F;dev&#x2F;sdc6</span><br></pre></td></tr></table></figure>

<p>从卷组提取容量创建逻辑卷</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L2G -n test_lv1 test_vg1</span><br></pre></td></tr></table></figure>





<p>实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fdisk &#x2F;dev&#x2F;sdb</span><br><span class="line"></span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line">1</span><br><span class="line">default</span><br><span class="line">+100G</span><br><span class="line"></span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line">2</span><br><span class="line">default</span><br><span class="line">+100G</span><br><span class="line"></span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line">3</span><br><span class="line">default</span><br><span class="line">+100G</span><br><span class="line"></span><br><span class="line">n</span><br><span class="line">e</span><br><span class="line">4</span><br><span class="line">default</span><br><span class="line">default</span><br><span class="line"></span><br><span class="line">n</span><br><span class="line">default</span><br><span class="line">default</span><br><span class="line">+100G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line">w</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pvcreate &#x2F;dev&#x2F;sdb&#123;1,2,3,5&#125;</span><br><span class="line"></span><br><span class="line">pvdisplay</span><br><span class="line"></span><br><span class="line">vgcreate test_vg &#x2F;dev&#x2F;sdb&#123;1,23,5&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lvcreate -n test_data -L 120G test_vg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lvdisplay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkfs.xfs &#x2F;dev&#x2F;test_vg&#x2F;test_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir &#x2F;data</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;dev&#x2F;test_vg&#x2F;test_data &#x2F;data xfs defaults 0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line">df -f</span><br></pre></td></tr></table></figure>



<p>修改容量实战</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pvcreate &#x2F;dev&#x2F;sdb6</span><br><span class="line">vgextend test_vg &#x2F;dev&#x2F;sdb6</span><br><span class="line">vdisplay test_vg</span><br><span class="line">lvextend -L +120G &#x2F;dev&#x2F;test&#x2F;vg&#x2F;test_data</span><br><span class="line"></span><br><span class="line">lvs</span><br><span class="line"></span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line">xfs_growfs &#x2F;dev&#x2F;test_vg&#x2F;test_data</span><br></pre></td></tr></table></figure>



<p>删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unmount</span><br><span class="line">lvremove</span><br><span class="line">vgremove</span><br><span class="line">pvremove</span><br></pre></td></tr></table></figure>







<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">fdisk &#x2F;dev&#x2F;vdb</span><br><span class="line"></span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line">1</span><br><span class="line">default</span><br><span class="line">default</span><br><span class="line"></span><br><span class="line"> pvcreate &#x2F;dev&#x2F;vdb1</span><br><span class="line"> </span><br><span class="line"> pvdisplay</span><br><span class="line"> </span><br><span class="line"> &quot;&#x2F;dev&#x2F;vdb1&quot; is a new physical volume of &quot;&lt;80.00 GiB&quot;</span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               &#x2F;dev&#x2F;vdb1</span><br><span class="line">  VG Name               </span><br><span class="line">  PV Size               &lt;80.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0   </span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               XBc3eK-BpCr-wRV2-7gbD-0GtR-Nn88-U14Fa3</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> vgcreate vg_data &#x2F;dev&#x2F;vdb1</span><br><span class="line"> vgdisplay</span><br><span class="line"> </span><br><span class="line"> --- Volume group ---</span><br><span class="line">  VG Name               vg_data</span><br><span class="line">  System ID             </span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        1</span><br><span class="line">  Metadata Sequence No  1</span><br><span class="line">  VG Access             read&#x2F;write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                0</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                1</span><br><span class="line">  Act PV                1</span><br><span class="line">  VG Size               &lt;80.00 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              20479</span><br><span class="line">  Alloc PE &#x2F; Size       0 &#x2F; 0   </span><br><span class="line">  Free  PE &#x2F; Size       20479 &#x2F; &lt;80.00 GiB</span><br><span class="line">  VG UUID               pdet2I-hDY6-pVNC-rr5Y-RnxY-zY8w-1jhHGY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lvcreate -n lv_data -L +70G vg_data</span><br><span class="line">lvdispaly</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> --- Logical volume ---</span><br><span class="line">  LV Path                &#x2F;dev&#x2F;vg_data&#x2F;lv_data</span><br><span class="line">  LV Name                lv_data</span><br><span class="line">  VG Name                vg_data</span><br><span class="line">  LV UUID                HRV3EX-SYnL-HqB0-M7CP-ymLb-LDr9-5KNYTG</span><br><span class="line">  LV Write Access        read&#x2F;write</span><br><span class="line">  LV Creation host, time gzzx27, 2020-10-26 14:17:34 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                70.00 GiB</span><br><span class="line">  Current LE             17920</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           252:0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;vda: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units &#x3D; sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0000d5d0</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">&#x2F;dev&#x2F;vda1   *        2048    41943006    20970479+  83  Linux</span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;vdb: 85.9 GB, 85899345920 bytes, 167772160 sectors</span><br><span class="line">Units &#x3D; sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0xe2c8403c</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">&#x2F;dev&#x2F;vdb1            2048   167772159    83885056   83  Linux</span><br><span class="line"></span><br><span class="line">Disk &#x2F;dev&#x2F;mapper&#x2F;vg_data-lv_data: 75.2 GB, 75161927680 bytes, 146800640 sectors</span><br><span class="line">Units &#x3D; sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkfs.xfs &#x2F;dev&#x2F;vg_data&#x2F;lv_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir &#x2F;data</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line">&#x2F;dev&#x2F;vg_data&#x2F;lv_data                      &#x2F;data                   xfs     defaults        0 0</span><br></pre></td></tr></table></figure>





<p>RAID</p>
<p>软件RAID</p>
<p>硬件RAID</p>
<p>网络参考</p>
<p><a href="https://blog.51cto.com/3241766/2398136" target="_blank" rel="noopener">https://blog.51cto.com/3241766/2398136</a></p>
<h3><span id="2-操作系统设置与优化">2. 操作系统设置与优化</span></h3><h4><span id="21-设置语言">2.1 设置语言</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/zh_CN.UTF-8/en_US.UTF-8/'</span> /etc/locale.conf</span><br><span class="line"><span class="built_in">source</span> /etc/locale.conf</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/locale.conf</span><br><span class="line">LANG=<span class="string">"en_US.UTF-8"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/locale.conf</span><br></pre></td></tr></table></figure>



<h4><span id="22-编辑网络">2.2 编辑网络</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts</span><br><span class="line">vi ifcfg-ens33</span><br></pre></td></tr></table></figure>

<p>IP配置如下  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.67.10</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.67.2</span><br><span class="line">IPV6_PRIVACY=no</span><br><span class="line">DNS1=144.144.144.144</span><br><span class="line">DNS2=8.8.8.8</span><br></pre></td></tr></table></figure>

<p>DNS设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> nameserver 8.8.8.8 &gt; /etc/resolv.conf</span><br><span class="line"><span class="built_in">echo</span> nameserver 144.144.144.144 &gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>重启网卡  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<p>主机名FQDN（Fully Qualified Domain Name）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname master01</span><br><span class="line"></span><br><span class="line">more &#x2F;etc&#x2F;hostname</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hostnamectl --static set-hostname node130.unionpay.com</span><br><span class="line"></span><br><span class="line">验证修改是否生效</span><br><span class="line">hostname -f</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line">192.168.67.130 node130.unionpay.com</span><br></pre></td></tr></table></figure>

<p>验证Mac和UUID 确保唯一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;sys&#x2F;class&#x2F;net&#x2F;ens160&#x2F;address</span><br><span class="line"></span><br><span class="line">cat &#x2F;sys&#x2F;class&#x2F;dmi&#x2F;id&#x2F;product_uuid</span><br></pre></td></tr></table></figure>



<p>防火墙设置  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#centos7启动防火墙</span><br><span class="line">systemctl start firewalld.service</span><br><span class="line">#centos7停止防火墙&#x2F;关闭防火墙</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">#centos7重启防火墙</span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line"> </span><br><span class="line">#设置开机启用防火墙</span><br><span class="line">systemctl enable firewalld.service</span><br><span class="line">#设置开机不启动防火墙</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">firewall-cmd  --zone=public  --add-port=8089/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line">firewall-cmd  --zone=public  --remove-port=8089/tcp --permanent</span><br></pre></td></tr></table></figure>

<h4><span id="23-用户和组设置">2.3 用户和组设置</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -s /bin/bash -d /home/lining -m lining</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd lining</span><br></pre></td></tr></table></figure>

<p>-s 指定用户登入后所使用的shell<br>-d 指定用户登入时的起始目录<br>-m 自动建立用户的登入目录<br>-g 指定用户所属的群组<br>-G 指定用户所属的附加群组  </p>
<p>添加sudo权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"lining ALL=(ALL) NOPASSWD: ALL"</span> | sudo tee /etc/sudoers.d/lining</span><br></pre></td></tr></table></figure>

<p>删除用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel -r lining</span><br></pre></td></tr></table></figure>

<p>修改用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $USER &amp;&amp; newgrp docker</span><br></pre></td></tr></table></figure>



<h4><span id="24-yum源设置">2.4 yum源设置</span></h4><p>Base和EPEL源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget</span><br><span class="line">mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo_bak</span><br><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class="line">wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;epel-7.repo https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;redhat-release</span><br><span class="line">7.9.2009</span><br><span class="line"></span><br><span class="line">vi Centos-7.repo</span><br><span class="line"></span><br><span class="line">:%s&#x2F;$releasever&#x2F;7.9.2009&#x2F;g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 清除缓存并生成新的缓存</span><br><span class="line">yum clan all</span><br><span class="line">yum makecache</span><br><span class="line">#查看可用的源仓库</span><br><span class="line">yum repolist</span><br><span class="line"></span><br><span class="line">#验证安装</span><br><span class="line">yum install -y net-tools</span><br></pre></td></tr></table></figure>



<h4><span id="25-防火墙与selinux">2.5  防火墙与SElinux</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i &#39;s&#x2F;^ *SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line"></span><br><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure>



<h4><span id="26-系统优化">2.6 系统优化</span></h4><p>禁用swap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a</span><br><span class="line">sed -i.bak &#39;&#x2F;swap&#x2F;s&#x2F;^&#x2F;#&#x2F;&#39; &#x2F;etc&#x2F;fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free -m</span><br></pre></td></tr></table></figure>

<p>文件句柄</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line"></span><br><span class="line">elasticsearch        hard     nofile         65535</span><br><span class="line">elasticsearch        soft     nofile         65535</span><br><span class="line"></span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nofile 65535</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">vm.max_map_count &#x3D; 262144</span><br></pre></td></tr></table></figure>



<p>2.7  SSH</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub root@172.27.34.4</span><br></pre></td></tr></table></figure>



<p>2.8 其他</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#查系统以及内核信息</span><br><span class="line">uname -a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;version</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;cpuinfo</span><br><span class="line"></span><br><span class="line">cat &#x2F;proc&#x2F;meminfo</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;centos-release</span><br></pre></td></tr></table></figure>



<p>2.9 FTP</p>
<p>vsftpd（very secure FTP daemon）是一款在Linux发行版中最受推崇的FTP服务器。vsftpd支持匿名访问和本地用户模式两种访问方式。匿名访问方式任何用户都可以访问搭建的FTP服务；本地用户模式只支持添加的本地用户访问搭建的FTP服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">yum install -y vsftpd</span><br><span class="line">systemctl enable vsftpd.service</span><br><span class="line">systemctl start vsftpd.service</span><br><span class="line">netstat -antup | grep ftp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf</span><br><span class="line"></span><br><span class="line">anon_upload_enable&#x3D;YES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod o+w &#x2F;var&#x2F;ftp&#x2F;pub&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart vsftpd.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">adduser ftptest</span><br><span class="line"></span><br><span class="line">passwd ftptest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir &#x2F;var&#x2F;ftp&#x2F;test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chown -R ftptest:ftptest &#x2F;var&#x2F;ftp&#x2F;test</span><br></pre></td></tr></table></figure>



<p>主动模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#39;s&#x2F;anonymous_enable&#x3D;YES&#x2F;anonymous_enable&#x3D;NO&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #禁止匿名登录FTP服务器 </span><br><span class="line">sed -i &#39;s&#x2F;listen&#x3D;NO&#x2F;listen&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #监听IPv4 sockets </span><br><span class="line">sed -i &#39;s&#x2F;listen_ipv6&#x3D;YES&#x2F;#listen_ipv6&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #关闭监听IPv6 sockets </span><br><span class="line">sed -i &#39;s&#x2F;#chroot_local_user&#x3D;YES&#x2F;chroot_local_user&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #全部用户被限制在主目录 </span><br><span class="line">sed -i &#39;s&#x2F;#chroot_list_enable&#x3D;YES&#x2F;chroot_list_enable&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #启用例外用户名单 </span><br><span class="line">sed -i &#39;s&#x2F;#chroot_list_file&#x3D;&#x2F;chroot_list_file&#x3D;&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #指定例外用户列表文件，列表中的用户不被锁定在主目录 </span><br><span class="line">echo &quot;allow_writeable_chroot&#x3D;YES&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf </span><br><span class="line">echo &quot;local_root&#x3D;&#x2F;var&#x2F;ftp&#x2F;test&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #设置本地用户登录后所在的目录</span><br></pre></td></tr></table></figure>

<p>被动模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#39;s&#x2F;anonymous_enable&#x3D;YES&#x2F;anonymous_enable&#x3D;NO&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #禁止匿名登录FTP服务器 </span><br><span class="line">sed -i &#39;s&#x2F;listen&#x3D;NO&#x2F;listen&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #监听IPv4 sockets </span><br><span class="line">sed -i &#39;s&#x2F;listen_ipv6&#x3D;YES&#x2F;#listen_ipv6&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #关闭监听IPv6 sockets </span><br><span class="line">sed -i &#39;s&#x2F;#chroot_local_user&#x3D;YES&#x2F;chroot_local_user&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #全部用户被限制在主目录 </span><br><span class="line">sed -i &#39;s&#x2F;#chroot_list_enable&#x3D;YES&#x2F;chroot_list_enable&#x3D;YES&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #启用例外用户名单 </span><br><span class="line">sed -i &#39;s&#x2F;#chroot_list_file&#x3D;&#x2F;chroot_list_file&#x3D;&#x2F;&#39; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #指定例外用户列表文件，列表中的用户不被锁定在主目录 </span><br><span class="line">echo &quot;allow_writeable_chroot&#x3D;YES&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf </span><br><span class="line">echo &quot;local_root&#x3D;&#x2F;var&#x2F;ftp&#x2F;test&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #设置本地用户登录后所在的目录 </span><br><span class="line"></span><br><span class="line">echo &quot;pasv_enable&#x3D;YES&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #开启被动模式 </span><br><span class="line">echo &quot;pasv_address&#x3D;&lt;FTP服务器公网IP地址&gt;&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #本教程中为ECS服务器弹性IP </span><br><span class="line">echo &quot;pasv_min_port&#x3D;20&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #设置被动模式下，建立数据传输可使用的端口范围的最小值 </span><br><span class="line">echo &quot;pasv_max_port&#x3D;21&quot; &gt;&gt; &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf #设置被动模式下，建立数据传输可使用的端口范围的最大值</span><br></pre></td></tr></table></figure>





<p><a href="ftp://139.0.0.1:21">ftp://139.0.0.1:21</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/elasticsearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/elasticsearch/" class="post-title-link" itemprop="url">ElasticSearch知识库</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#elasticsearch知识库">ElasticSearch知识库</a></li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="elasticsearch知识库">ElasticSearch知识库</span></h2><p>创建索引  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">"http://localhost:9200/company?include_type_name=true"</span> -H <span class="string">"Content-Type: application/json"</span> -d <span class="string">'&#123;"mappings":&#123;"_doc":&#123;"properties":&#123;"companyId":&#123;"type":"text","fields":&#123;"keyword":&#123;"type":"keyword","ignore_above":256&#125;&#125;&#125;,"entName":&#123;"type":"text","analyzer":"ik_max_word"&#125;,"entTypeId":&#123;"type":"integer"&#125;,"estDate":&#123;"type":"date"&#125;,"historyName":&#123;"type":"text","analyzer":"ik_max_word"&#125;,"industryId":&#123;"type":"keyword"&#125;,"keyPerson":&#123;"type":"keyword"&#125;,"provinceId":&#123;"type":"integer"&#125;,"regCap":&#123;"type":"double"&#125;,"regNo":&#123;"type":"keyword"&#125;,"uniscId":&#123;"type":"keyword"&#125;&#125;&#125;&#125;&#125;'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE company</span><br><span class="line">GET company/_search</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">"http://127.0.0.1:9200/company/_mapping"</span></span><br><span class="line">curl <span class="string">"http://127.0.0.1:9200/company/_search"</span></span><br><span class="line">curl -X DELETE <span class="string">"http://127.0.0.1:9200/company"</span></span><br><span class="line">curl -XGET <span class="string">"http://127.0.0.1:9200/company/_doc/_search"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'&#123;"query" : &#123;  "multi_match" : &#123;    "query" : "上海银行股份有限公司",    "fields" : ["entName","historyName"]  &#125;  &#125;&#125;'</span></span><br></pre></td></tr></table></figure>

<p>安装ik分词器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip</span><br></pre></td></tr></table></figure>


<p>查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"elasticService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticServiceImpl</span> <span class="keyword">implements</span> <span class="title">ElasticService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ESCompanyInfoRepository esCompanyInfoRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ESCompanyInfo&gt; <span class="title">findByContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 这里不需要分页，需要查询所有的。</span></span><br><span class="line">        <span class="comment">// 但是考虑性能问题，暂时设置为10000条</span></span><br><span class="line">        <span class="comment">// 是否需要遍历所有的数据？</span></span><br><span class="line">        QueryBuilder q = QueryBuilders.multiMatchQuery(content,<span class="string">"entName"</span>, <span class="string">"historyName"</span>, <span class="string">"unsicId"</span>, <span class="string">"regNo"</span>, <span class="string">"name"</span>);</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = <span class="keyword">new</span> NativeSearchQueryBuilder();</span><br><span class="line">        queryBuilder.withQuery(q);</span><br><span class="line">        queryBuilder.withPageable(PageRequest.of(<span class="number">0</span>, <span class="number">10000</span>));</span><br><span class="line">        Page&lt;ESCompanyInfo&gt; page = esCompanyInfoRepository.search(queryBuilder.build());</span><br><span class="line">        <span class="keyword">return</span> page.getContent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ESCompanyInfo&gt; <span class="title">findByContent</span><span class="params">(String content, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        QueryBuilder q;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span> :</span><br><span class="line">                q =  QueryBuilders.matchQuery(content, <span class="string">"unsicId"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span> :</span><br><span class="line">                q =  QueryBuilders.matchQuery(content, <span class="string">"regNo"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span> :</span><br><span class="line">                q =  QueryBuilders.matchQuery(content, <span class="string">"name"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                q =  QueryBuilders.multiMatchQuery(content,<span class="string">"entName"</span>, <span class="string">"historyName"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = <span class="keyword">new</span> NativeSearchQueryBuilder();</span><br><span class="line">        queryBuilder.withQuery(q);</span><br><span class="line">        queryBuilder.withPageable(PageRequest.of(<span class="number">0</span>, <span class="number">10000</span>));</span><br><span class="line">        Page&lt;ESCompanyInfo&gt; page = esCompanyInfoRepository.search(queryBuilder.build());</span><br><span class="line">        <span class="keyword">return</span> page.getContent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;ESCompanyInfo&gt; <span class="title">findByContent</span><span class="params">(FilterBean filterBean)</span> </span>&#123;</span><br><span class="line">        List&lt;QueryBuilder&gt; allQueryBuilder = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        QueryBuilder contentQuery;</span><br><span class="line">        <span class="keyword">switch</span> (filterBean.getContentType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span> :</span><br><span class="line">                contentQuery =  QueryBuilders.termQuery(<span class="string">"uniscId"</span>, filterBean.getContent());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span> :</span><br><span class="line">                contentQuery =  QueryBuilders.termQuery(<span class="string">"regNo"</span>, filterBean.getContent());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span> :</span><br><span class="line">                contentQuery =  QueryBuilders.termsQuery(<span class="string">"keyPerson"</span>, filterBean.getContent());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                contentQuery =  QueryBuilders.matchQuery(<span class="string">"entName"</span>, filterBean.getContent()).analyzer(<span class="string">"ik_max_word"</span>).minimumShouldMatch(<span class="string">"100%"</span>);;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        allQueryBuilder.add(contentQuery);</span><br><span class="line">        QueryBuilder estDateQuery;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != filterBean.getEstYearsMin()) &#123;</span><br><span class="line">            <span class="keyword">int</span> min = -Math.abs(filterBean.getEstYearsMin());</span><br><span class="line">            Date minDate = getTargetDate(min);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != filterBean.getEstYearsMax()) &#123;</span><br><span class="line">                <span class="keyword">int</span> max = -Math.abs(filterBean.getEstYearsMax());</span><br><span class="line">                Date maxDate = getTargetDate(max);</span><br><span class="line">                estDateQuery = QueryBuilders.rangeQuery(<span class="string">"estDate"</span>).from(maxDate.getTime()).to(minDate.getTime());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                estDateQuery = QueryBuilders.rangeQuery(<span class="string">"estDate"</span>).lte(minDate.getTime());</span><br><span class="line">            &#125;</span><br><span class="line">            allQueryBuilder.add(estDateQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        QueryBuilder regCapQuery;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != filterBean.getRegCapMin() || <span class="keyword">null</span> != filterBean.getRegCapMax()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != filterBean.getRegCapMax()) &#123;</span><br><span class="line">                regCapQuery = QueryBuilders.rangeQuery(<span class="string">"regCap"</span>).from(filterBean.getRegCapMin().doubleValue()).to(filterBean.getRegCapMax().doubleValue());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                regCapQuery = QueryBuilders.rangeQuery(<span class="string">"regCap"</span>).gte(filterBean.getRegCapMin().doubleValue());</span><br><span class="line">            &#125;</span><br><span class="line">            allQueryBuilder.add(regCapQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        QueryBuilder industryQuery;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(filterBean.getIndustryId())) &#123;</span><br><span class="line">            industryQuery = QueryBuilders.termQuery(<span class="string">"industryId"</span>, filterBean.getIndustryId());</span><br><span class="line">            allQueryBuilder.add(industryQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        QueryBuilder provinceQuery;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != filterBean.getProvinceId()) &#123;</span><br><span class="line">            provinceQuery = QueryBuilders.termQuery(<span class="string">"provinceId"</span>, filterBean.getProvinceId());</span><br><span class="line">            allQueryBuilder.add(provinceQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        QueryBuilder entTypeQuery;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != filterBean.getEntTypeId()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1000</span> == filterBean.getEntTypeId()) &#123;</span><br><span class="line">                entTypeQuery = QueryBuilders.rangeQuery(<span class="string">"entTypeId"</span>).from(<span class="number">1000</span>, <span class="keyword">true</span>).to(<span class="number">5000</span>, <span class="keyword">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                entTypeQuery = QueryBuilders.rangeQuery(<span class="string">"entTypeId"</span>).from(filterBean.getEntTypeId(), <span class="keyword">true</span>).to(filterBean.getEntTypeId() + <span class="number">1000</span>, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            allQueryBuilder.add(entTypeQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="keyword">for</span> (QueryBuilder queryBuilder : allQueryBuilder) &#123;</span><br><span class="line">            boolQueryBuilder.must(queryBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//SortBuilder sortBuilder = SortBuilders.fieldSort("regCap").order(SortOrder.DESC);</span></span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = <span class="keyword">new</span> NativeSearchQueryBuilder();</span><br><span class="line">        queryBuilder.withQuery(boolQueryBuilder);</span><br><span class="line">        <span class="comment">//前端传的pageNum初始为1</span></span><br><span class="line">        queryBuilder.withPageable(PageRequest.of(filterBean.getPageNum() - <span class="number">1</span>, filterBean.getPageSize()));</span><br><span class="line">        <span class="comment">//queryBuilder.withSort(sortBuilder);</span></span><br><span class="line">        <span class="keyword">return</span> esCompanyInfoRepository.search(queryBuilder.build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;ESCompanyInfo&gt; <span class="title">searchByContent</span><span class="params">(Integer pageNumber, Integer pageSize, String content)</span> </span>&#123;</span><br><span class="line">        QueryBuilder q = QueryBuilders.multiMatchQuery(content,<span class="string">"entName"</span>, <span class="string">"historyName"</span>, <span class="string">"companyId"</span>, <span class="string">"regNo"</span>, <span class="string">"keyPerson"</span>);</span><br><span class="line">        NativeSearchQueryBuilder queryBuilder = <span class="keyword">new</span> NativeSearchQueryBuilder();</span><br><span class="line">        queryBuilder.withQuery(q);</span><br><span class="line">        queryBuilder.withPageable(PageRequest.of(pageNumber, pageSize));</span><br><span class="line">        <span class="keyword">return</span> esCompanyInfoRepository.search(queryBuilder.build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Date <span class="title">getTargetDate</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        Calendar c = Calendar.getInstance();</span><br><span class="line">        c.setTime(<span class="keyword">new</span> Date());</span><br><span class="line">        c.add(Calendar.YEAR, a);</span><br><span class="line">        <span class="keyword">return</span> c.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/linux/" class="post-title-link" itemprop="url">Linux知识库</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#centos知识库">Centos知识库</a></li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="centos知识库">Centos知识库</span></h2><p>设置语言  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/zh_CN.UTF-8/en_US.UTF-8/'</span> /etc/locale.conf</span><br><span class="line"><span class="built_in">source</span> /etc/locale.conf</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/locale.conf</span><br><span class="line">LANG=<span class="string">"en_US.UTF-8"</span></span><br></pre></td></tr></table></figure>

<p>编辑网络  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts</span><br><span class="line">vi ifcfg-ens33</span><br></pre></td></tr></table></figure>

<p>IP配置如下  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=<span class="string">"Ethernet"</span></span><br><span class="line">PROXY_METHOD=<span class="string">"none"</span></span><br><span class="line">BROWSER_ONLY=<span class="string">"no"</span></span><br><span class="line">BOOTPROTO=<span class="string">"static"</span></span><br><span class="line">DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6INIT=<span class="string">"yes"</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">"yes"</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">"stable-privacy"</span></span><br><span class="line">NAME=<span class="string">"ens33"</span></span><br><span class="line">UUID=<span class="string">"83d30ac2-a959-49c9-a4ae-29753b902358"</span></span><br><span class="line">DEVICE=<span class="string">"ens33"</span></span><br><span class="line">ONBOOT=<span class="string">"yes"</span></span><br><span class="line">IPADDR=192.168.67.130</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.67.2</span><br><span class="line">DNS=8.8.8.8</span><br><span class="line">ZONE=public</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=973bd697-6d2a-4b6c-909e-ccb0923c4209</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.67.10</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.67.2</span><br><span class="line">IPV6_PRIVACY=no</span><br><span class="line">DNS1=144.144.144.144</span><br></pre></td></tr></table></figure>

<p>DNS设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> nameserver 8.8.8.8 &gt; /etc/resolv.conf</span><br><span class="line"><span class="built_in">echo</span> nameserver 144.144.144.144 &gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>重启网卡  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<p>防火墙设置  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd  --zone=public  --add-port=8089/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>

<p>用户设置  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -s /bin/bash -d /opt/stack -m stack</span><br><span class="line">sudo useradd -s /bin/bash -d /home/lining -m lining</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd lining</span><br></pre></td></tr></table></figure>

<p>-s 指定用户登入后所使用的shell<br>-d 指定用户登入时的起始目录<br>-m 自动建立用户的登入目录<br>-g 指定用户所属的群组<br>-G 指定用户所属的附加群组  </p>
<p>添加sudo权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"stack ALL=(ALL) NOPASSWD: ALL"</span> | sudo tee /etc/sudoers.d/stack</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stack ALL=(ALL) NOPASSWD: ALL"</span> | sudo tee /etc/sudoers.d/lining</span><br></pre></td></tr></table></figure>

<p>删除用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel -r lining</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/mysql/" class="post-title-link" itemprop="url">MySQL知识库</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#mysql安装">MySQL安装</a></li>
<li><a href="#mysql知识库">MySQL知识库</a></li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="mysql安装">MySQL安装</span></h2><ul>
<li>配置安装源</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看RPM源</span></span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装工具</span></span><br><span class="line">yum -y install yum-utils</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">MySQL 8.0</span></span><br><span class="line">yum-config-manager --enable mysql80-community</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">MySQL 5.7</span></span><br><span class="line">yum-config-manager --disable mysql57-community</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">对应的文件,注意时Centos 7 还是6 对应的URL不一样</span></span><br><span class="line">vi /etc/yum.repos.d/mysql-community.repo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enable to use MySQL 8.0</span></span><br><span class="line">[mysql80-community]</span><br><span class="line">name=MySQL 8.0 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-8.0-community/el/7/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">或者</span></span><br><span class="line">[mysql57-community]</span><br><span class="line">name=MySQL 5.7 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/6/$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br></pre></td></tr></table></figure>



<ul>
<li>下载安装包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-&#123;server,client,common,libs&#125;-*</span><br></pre></td></tr></table></figure>



<ul>
<li>启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">systemctl enable mysqld</span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure>



<p>配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">开启防火墙</span></span><br><span class="line">firewall-cmd  --zone=public  --add-port=3306/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">初始密码</span></span><br><span class="line">grep 'temporary password' /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">权限相关</span></span><br><span class="line"><span class="meta">#</span><span class="bash">登录</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改密码 密码强度至少1个大写字母，1个小写字母，1个数字，1个特殊字符，至少8位长度</span></span><br><span class="line">ALTER USER 'root'@'localhost' IDENTIFIED BY 'Lining1992!';</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create database consumer default character set utf8;</span><br><span class="line">CREATE USER '[USER]'@'%' IDENTIFIED BY '[PWD]';</span><br><span class="line">GRANT ALL PRIVILEGES ON metastore. * TO '[USER]'@'%';</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create database apbizdb default character set utf8mb4;</span><br><span class="line">GRANT ALL ON apbizdb.* TO 'ap_bizas'@'%';</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>




<h2><span id="mysql知识库">MySQL知识库</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u[USER] -p[PWD] -h[IP] -P3306 consumer</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> consumer <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'[USER]'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'[PWD]'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> metastore. * <span class="keyword">TO</span> <span class="string">'[USER]'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>


<p>MySQL Dump</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u[USER] -p[PWD] -h[IP] business_portrait &gt; /opt/all.sql</span><br><span class="line"></span><br><span class="line">mysqldump -t -u[USER] -p[PWD] -h[IP] ods bp_alter_info &gt; logs/bp_alter_info.sql</span><br></pre></td></tr></table></figure>

<p>Common ETL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">insert into bp_license_info</span><br><span class="line">select id,unisc_id</span><br><span class="line">,reg_no</span><br><span class="line">,null</span><br><span class="line">,ent_name</span><br><span class="line">,history_name</span><br><span class="line">,ent_type_cn</span><br><span class="line">,ent_type</span><br><span class="line">,name</span><br><span class="line">,<span class="keyword">case</span> when reg_cap = <span class="string">'null'</span> <span class="keyword">then</span> null <span class="keyword">else</span> reg_cap end reg_cap</span><br><span class="line">,reg_cap_cur_cn</span><br><span class="line">,est_date</span><br><span class="line">,<span class="keyword">case</span> when op_from = <span class="string">'null'</span> <span class="keyword">then</span> null  <span class="keyword">else</span> op_from end  op_from</span><br><span class="line">,<span class="keyword">case</span> when op_to = <span class="string">'null'</span> <span class="keyword">then</span> null  <span class="keyword">else</span> op_to end op_to</span><br><span class="line">,reg_org_cn</span><br><span class="line">,node_num</span><br><span class="line">,appr_date</span><br><span class="line">,dom</span><br><span class="line">,reg_state_cn</span><br><span class="line">,null</span><br><span class="line">,op_scope</span><br><span class="line">from dwd_b_company_base_newest_a_day <span class="built_in">where</span> stat_date = <span class="string">'20191205'</span>;</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	bp_license_info.company_id AS companyId,</span><br><span class="line">	bp_license_info.ent_name AS NAME,</span><br><span class="line">	bp_license_info.reg_state AS regState,</span><br><span class="line">	ISNULL(bp_license_info.reg_cap) AS regCap,</span><br><span class="line">	bp_license_info.ent_type AS entType,</span><br><span class="line">    <span class="string">'Company'</span> as LABEL</span><br><span class="line">FROM bp_license_info</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO bp_license_info SELECT</span><br><span class="line">	id,</span><br><span class="line">	unisc_id,</span><br><span class="line">	reg_no,</span><br><span class="line">	NULL,</span><br><span class="line">	ent_name,</span><br><span class="line">	history_name,</span><br><span class="line">	ent_type_cn,</span><br><span class="line">	ent_type,</span><br><span class="line">	NAME,</span><br><span class="line">	CASE</span><br><span class="line">WHEN reg_cap = <span class="string">'null'</span> THEN</span><br><span class="line">	NULL</span><br><span class="line">ELSE</span><br><span class="line">	reg_cap</span><br><span class="line">END reg_cap,</span><br><span class="line"> reg_cap_cur_cn,</span><br><span class="line"> est_date,</span><br><span class="line"> CASE</span><br><span class="line">WHEN op_from = <span class="string">'null'</span> THEN</span><br><span class="line">	NULL</span><br><span class="line">ELSE</span><br><span class="line">	op_from</span><br><span class="line">END op_from,</span><br><span class="line"> CASE</span><br><span class="line">WHEN op_to = <span class="string">'null'</span> THEN</span><br><span class="line">	NULL</span><br><span class="line">ELSE</span><br><span class="line">	op_to</span><br><span class="line">END op_to,</span><br><span class="line"> reg_org_cn,</span><br><span class="line"> node_num,</span><br><span class="line"> appr_date,</span><br><span class="line"> dom,</span><br><span class="line"> reg_state_cn,</span><br><span class="line"> NULL,</span><br><span class="line"> op_scope</span><br><span class="line">FROM</span><br><span class="line">	dwd_b_company_base_newest_a_day</span><br><span class="line">WHERE</span><br><span class="line">	stat_date = <span class="string">'20191205'</span></span><br><span class="line">AND ent_name IS NOT NULL;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2020/03/17/neo4j/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="李宁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李宁的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/17/neo4j/" class="post-title-link" itemprop="url">Neo4j知识库</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-17 09:38:39" itemprop="dateModified" datetime="2022-01-17T09:38:39+08:00">2022-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Neo4j/" itemprop="url" rel="index"><span itemprop="name">Neo4j</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<ul>
<li><a href="#neo4j知识库">Neo4j知识库</a><ul>
<li><a href="#数据同步-mysql-neo4j">数据同步 mysql - neo4j</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<hr>
<h2><span id="neo4j知识库">Neo4j知识库</span></h2><h3><span id="数据同步-mysql-neo4j">数据同步 mysql - neo4j</span></h3><p>将数据导出为csv文件  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	bp_license_info.company_id AS companyId,</span><br><span class="line">	TRIM(bp_license_info.ent_name) AS name,</span><br><span class="line">	bp_license_info.reg_state AS regState,</span><br><span class="line">	IFNULL(bp_license_info.reg_cap, 0) AS regCap,</span><br><span class="line">	bp_license_info.ent_type AS entType,</span><br><span class="line">	<span class="string">'Company'</span> AS LABEL</span><br><span class="line">FROM</span><br><span class="line">	bp_license_info INTO OUTFILE <span class="string">'/var/lib/mysql-files/neo4j/company.csv'</span> FIELDS TERMINATED BY <span class="string">'\|'</span> LINES TERMINATED BY <span class="string">'\n'</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	bp_keyperson_info.senior_id AS seniorId,</span><br><span class="line">	bp_keyperson_info.`name` AS name,</span><br><span class="line">	bp_keyperson_info.position AS position,</span><br><span class="line">  <span class="string">'Person'</span> AS LABEL</span><br><span class="line">FROM bp_keyperson_info INTO OUTFILE <span class="string">'/var/lib/mysql-files/person.csv'</span> FIELDS TERMINATED BY <span class="string">'\t'</span> LINES TERMINATED BY <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	bp_keyperson_info.senior_id AS startId,</span><br><span class="line">	IFNULL(bp_keyperson_info.position, <span class="string">'未知'</span>) AS role,</span><br><span class="line">	bp_keyperson_info.company_id AS endId,</span><br><span class="line">	<span class="string">'EMPLOY'</span> AS <span class="built_in">type</span></span><br><span class="line">FROM</span><br><span class="line">	bp_keyperson_info INTO OUTFILE <span class="string">'/var/lib/mysql-files/keyperson.csv'</span> FIELDS TERMINATED BY <span class="string">'\t'</span> LINES TERMINATED BY <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	bp_stockholder_info.stock_company_id AS startId,</span><br><span class="line">	<span class="string">"参股"</span> AS role,</span><br><span class="line">	IFNULL(bp_stockholder_info.ac_con_am,0) AS acConAm,</span><br><span class="line">	IFNULL(bp_stockholder_info.sub_con_am,0) AS subConAm,</span><br><span class="line">	bp_stockholder_info.company_id AS endId,</span><br><span class="line">	<span class="string">'INVEST'</span> AS <span class="built_in">type</span></span><br><span class="line">FROM</span><br><span class="line">	bp_stockholder_info</span><br><span class="line">WHERE</span><br><span class="line">	bp_stockholder_info.stock_company_id IS NOT NULL</span><br><span class="line"></span><br><span class="line">INTO OUTFILE <span class="string">'/var/lib/mysql-files/stockCompany.csv'</span> FIELDS TERMINATED BY <span class="string">'\t'</span> LINES TERMINATED BY <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	CONCAT(bp_stockholder_info.stock_id,<span class="string">"_stock"</span>) AS stockId,</span><br><span class="line">	bp_stockholder_info.inv_name AS name,</span><br><span class="line">	bp_stockholder_info.inv_id_type AS stockType,</span><br><span class="line">  <span class="string">'Stock'</span> AS LABEL</span><br><span class="line">FROM</span><br><span class="line">	bp_stockholder_info</span><br><span class="line">WHERE</span><br><span class="line">	bp_stockholder_info.stock_company_id IS NULL</span><br><span class="line">INTO OUTFILE <span class="string">'/var/lib/mysql-files/stock.csv'</span> FIELDS TERMINATED BY <span class="string">'\t'</span> LINES TERMINATED BY <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	CONCAT(bp_stockholder_info.stock_id,<span class="string">"_stock"</span>) AS startId,</span><br><span class="line">	<span class="string">"参股"</span> AS role,</span><br><span class="line">	IFNULL(bp_stockholder_info.ac_con_am,0) AS acConAm,</span><br><span class="line">	IFNULL(bp_stockholder_info.sub_con_am,0) AS subConAm,</span><br><span class="line">	bp_stockholder_info.company_id AS endId,</span><br><span class="line">	<span class="string">'INVEST'</span> AS <span class="built_in">type</span></span><br><span class="line">FROM</span><br><span class="line">	bp_stockholder_info</span><br><span class="line">WHERE</span><br><span class="line">	bp_stockholder_info.stock_company_id IS NULL</span><br><span class="line"></span><br><span class="line">INTO OUTFILE <span class="string">'/var/lib/mysql-files/stockStock.csv'</span> FIELDS TERMINATED BY <span class="string">'\t'</span> LINES TERMINATED BY <span class="string">'\n'</span></span><br></pre></td></tr></table></figure>

<p>注意mysql配置了文件的导出位置，如果需要其他位置，请先设置  </p>
<p>执行mysql  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u[USER]]-p[PWD] -h[IP]] business_portrait -e <span class="string">"source /home/lining/company.sql"</span></span><br></pre></td></tr></table></figure>

<p>定义neo4j头文件company_header.csv  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">companyId:ID|name:string|regState:string|regCap:double|entType:string|:LABEL</span><br></pre></td></tr></table></figure>

<p>使用neo4j-import 导入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/neo4j-import --into data/databases/abce.db  --nodes <span class="string">"data/company_header.csv,data/company.csv"</span> --nodes <span class="string">"data/person_header.csv,data/person.csv"</span> --nodes <span class="string">"data/stock_header.csv,data/stock.csv"</span> --relationships <span class="string">"data/keyperson_header.csv,data/keyperson.csv"</span> --relationships <span class="string">"data/stock_r_header.csv,data/stockCompany.csv,data/stockStock.csv"</span> --delimiter <span class="string">'\t'</span> --stackTrace <span class="literal">true</span></span><br></pre></td></tr></table></figure>


<p>备份并删除graph.db  </p>
<p>重命名abce.db为graph.db</p>
<p>修改graph.db目录权限  </p>
<p>常用查询命令  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CREATE (:Company &#123;companyId:&quot;91310000736239890T&quot;,name:&quot;中国银联股份有限公司&quot;,regState: &quot;存续（在营、开业、在册）&quot;,regCap;200000,entType:&quot;其他股份有限公司(非上市)&quot;&#125;)</span><br><span class="line"></span><br><span class="line">CREATE (yinlain:Company &#123;companyId:&quot;91310000736239890T&quot;,name:&quot;中国银联股份有限公司&quot;,regState: &quot;存续（在营、开业、在册）&quot;,regCap;200000,entType:&quot;其他股份有限公司(非上市)&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (pudong:Company &#123;companyId:&quot;9131000013221158XC&quot;,name:&quot;上海浦东发展银行股份有限公司&quot;,regState: &quot;存续（在营、开业、在册）&quot;,regCap;1865347.1415,entType:&quot;其他股份有限公司(上市)&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (shanghaibk:Company &#123;companyId:&quot;91310000132257510M&quot;,name:&quot;上海银行股份有限公司&quot;,regState: &quot;存续（在营、开业、在册）&quot;,regCap;1420652.87,entType:&quot;股份有限公司(中外合资、上市)&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (mingsheng:Company &#123;companyId:&quot;91110000100018988F&quot;,name:&quot;中国民生银行股份有限公司&quot;,regState: &quot;开业&quot;,regCap;2836558.5227,entType:&quot;其他股份有限公司(上市)&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (shm:Person &#123;name:&quot;施红敏&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (lzy:Person &#123;name:&quot;李泽云&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (swz:Person &#123;name:&quot;时文朝&quot;&#125;),</span><br><span class="line"></span><br><span class="line">CREATE (shm) - [:DIRECTOR  &#123;role:&quot;董事&quot;&#125;]  -&gt;  (yinlain),</span><br><span class="line"></span><br><span class="line">CREATE (lzy) - [:DIRECTOR  &#123;role:&quot;董事&quot;&#125;]  -&gt;  (yinlain),</span><br><span class="line"></span><br><span class="line">CREATE (swz) - [:DIRECTOR  &#123;role:&quot;副董事&quot;&#125;]  -&gt;  (yinlain),</span><br><span class="line"></span><br><span class="line">CREATE (swz) - [:CORPORATION  &#123;role:&quot;法人&quot;&#125;]  -&gt;  (yinlain),</span><br><span class="line"></span><br><span class="line">CREATE (pudong) - [:SHARE  &#123;subConAm:8000&#125;]  -&gt;  (yinlain),</span><br><span class="line"></span><br><span class="line">CREATE (shanghaibk) - [:SHARE  &#123;subConAm:4000&#125;]  -&gt;  (yinlain),</span><br><span class="line"></span><br><span class="line">CREATE (mingsheng) - [:SHARE  &#123;subConAm:5000&#125;]  -&gt;  (yinlain)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">match p=(c:Company &#123;companyId:<span class="string">"91310000736239890T"</span>&#125;)-[*..2]-()  <span class="built_in">return</span> p</span><br><span class="line">match p=(c)-[*1..]-(n:Company &#123;companyId:<span class="string">"A8838833170311EA84780242AC110003"</span>&#125;) <span class="built_in">return</span> p</span><br><span class="line">match p=(c:Company &#123;companyId:<span class="string">"91310000736239890T"</span>&#125;)-[*..6]-()  <span class="built_in">return</span> p</span><br><span class="line">match p=(cc:Company)-[r:INVEST*..6]-(c:Company &#123;companyId:<span class="string">"91310000736239890T"</span>&#125;) <span class="built_in">return</span> p</span><br><span class="line">match p=(c:Company &#123;companyId:<span class="string">"26873"</span>&#125;)&lt;-[r:INVEST*..6]-(cc:Company)  <span class="built_in">return</span> p</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CompanyRepository</span> <span class="keyword">extends</span> <span class="title">Neo4jRepository</span>&lt;<span class="title">Company</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Company <span class="title">findByCompanyId</span><span class="params">(String companyId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(n)-[r:INVEST]-(c:Company &#123;companyId: &#123;companyId&#125;&#125;) RETURN sum(r.acConAm)"</span>)</span><br><span class="line">    <span class="function">Double <span class="title">getTotalStock</span><span class="params">(@Param(<span class="string">"companyId"</span>)</span> String companyId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH (c:Company &#123;companyId: &#123;companyId&#125;&#125;) RETURN labels(c)"</span>)</span><br><span class="line">    <span class="function">List&lt;String&gt; <span class="title">getLabelsByCompanyId</span><span class="params">(@Param(<span class="string">"companyId"</span>)</span> String companyId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(n)-[r:INVEST]-(c:Company &#123;companyId: &#123;companyId&#125;&#125;) RETURN p"</span>)</span><br><span class="line">    List&lt;Map&lt;String, Path&gt;&gt; getStockAnalysis(<span class="meta">@Param</span>(<span class="string">"companyId"</span>) String companyId);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(n)-[r]-(c:Company &#123;companyId: &#123;companyId&#125;&#125;) RETURN id(n) AS id, labels(n) AS labels, n AS properties "</span>)</span><br><span class="line">    <span class="function">List&lt;CompanyOrPersonResult&gt; <span class="title">getCompanyOrPerson</span><span class="params">(@Param(<span class="string">"companyId"</span>)</span> String companyId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(n)-[r]-(c:Company &#123;companyId: &#123;companyId&#125;&#125;) RETURN id(r) AS id, type(r) AS type, id(startnode(r)) AS startNode, id(endnode(r)) AS  endNode, r.role AS role "</span>)</span><br><span class="line">    <span class="function">List&lt;RelationShipResult&gt; <span class="title">getCPRelationShipResult</span><span class="params">(@Param(<span class="string">"companyId"</span>)</span> String companyId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(c:Company &#123;companyId: &#123;companyId&#125;&#125;)&lt;-[r:INVEST*..6]-(n) RETURN p"</span>)</span><br><span class="line">    List&lt;Map&lt;String, Path&gt;&gt; getActualController(<span class="meta">@Param</span>(<span class="string">"companyId"</span>) String companyId);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(n)-[r:INVEST]-&gt;(c:Company) where ID(c)=&#123;nid&#125; RETURN sum(r.acConAm)"</span>)</span><br><span class="line">    <span class="function">Double <span class="title">getTotalStockById</span><span class="params">(@Param(<span class="string">"nid"</span>)</span> Long nid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"MATCH p=(n)-[r:INVEST]-&gt;(c:Company) where ID(c)=&#123;nid&#125; RETURN ID(STARTNODE(r)) as id, r.acConAm as acConAm"</span>)</span><br><span class="line">    <span class="function">List&lt;IDAcConAm&gt; <span class="title">getIDListById</span><span class="params">(@Param(<span class="string">"nid"</span>)</span> Long nid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">Optional&lt;Company&gt; <span class="title">findById</span><span class="params">(Long aLong)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">李宁</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李宁</span>
</div>
  <div class="powered-by">万物之始，大道至简
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">知易行难，悟在天成
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
